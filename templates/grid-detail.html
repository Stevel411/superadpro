<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Grid Detail — SuperAdPro</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Inter",sans-serif;background:#f0f4f8;color:#0f172a;min-height:100vh}
    .page{max-width:900px;margin:0 auto;padding:32px 20px}
    .back-btn{display:inline-flex;align-items:center;gap:6px;color:#64748b;font-size:13px;font-weight:600;text-decoration:none;margin-bottom:20px;padding:6px 12px;border:1px solid #d0d8e4;border-radius:7px;background:#fff}
    .back-btn:hover{background:#f5f7fb}
    .card{background:#fff;border:1px solid #d0d8e4;border-radius:16px;padding:28px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,0.06)}
    h1{font-size:22px;font-weight:800;color:#0f172a;margin-bottom:4px}
    .meta{font-size:13px;color:#64748b;margin-bottom:20px}
    .stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
    .stat{background:#f5f7fb;border:1px solid #d0d8e4;border-radius:12px;padding:16px;text-align:center}
    .stat-label{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#6b7d94;margin-bottom:4px}
    .stat-value{font-size:26px;font-weight:900;color:#0f172a}
    .grid-visual{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;margin-top:16px}
    .pos{width:100%;aspect-ratio:1;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;border:2px solid transparent}
    .pos.filled{background:linear-gradient(135deg,#00b4d8,#6d28d9);color:#fff;border-color:transparent}
    .pos.empty{background:#eef2f7;color:#cbd5e1;border-color:#e2e8f0}
    .pos.owner{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border-color:transparent}
  </style>
</head>
<body>
<div class="page">
  <a href="/income-grid" class="back-btn">← Back to Income Grid</a>

  <div class="card">
    <h1>Grid #{{ grid.advance_number }} — ${{ grid.package_price|int }} Tier</h1>
    <div class="meta">Advance {{ grid.advance_number }} &nbsp;·&nbsp; {{ grid.positions_filled }}/64 positions filled &nbsp;·&nbsp; {{ "Complete" if grid.is_complete else "Active" }}</div>

    <div class="stat-row">
      <div class="stat">
        <div class="stat-label">Positions Filled</div>
        <div class="stat-value">{{ grid.positions_filled }}/64</div>
      </div>
      <div class="stat">
        <div class="stat-label">Progress</div>
        <div class="stat-value">{{ ((grid.positions_filled / 64) * 100)|int }}%</div>
      </div>
      <div class="stat">
        <div class="stat-label">Revenue Total</div>
        <div class="stat-value">${{ "%.2f"|format(grid.revenue_total or 0) }}</div>
      </div>
    </div>

    <h2 style="font-size:15px;font-weight:800;margin-bottom:12px;color:#374151">Grid Positions</h2>
    <div class="grid-visual">
      {% for pos in range(1, 65) %}
        {% set found = namespace(member=none) %}
        {% for level, level_positions in positions.items() %}
          {% for p in level_positions %}
            {% if p.position_num == pos %}{% set found.member = p %}{% endif %}
          {% endfor %}
        {% endfor %}
        {% if found.member %}
          <div class="pos filled" title="Member: {{ found.member.member_id }}">{{ pos }}</div>
        {% else %}
          <div class="pos empty">{{ pos }}</div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
</body>
</html>