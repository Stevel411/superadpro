<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pass-Up Visualiser — SuperAdPro</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@700;800&family=DM+Sans:wght@400;500;600;700;800&family=Rethink+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--cyan:#38bdf8;--cyan2:#0ea5e9;--green:#10b981;--gold:#f59e0b;--bg:#f0f2f8;--border:#e2e8f0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans','Rethink Sans',sans-serif;background:var(--bg);color:#0f172a;min-height:100vh;overflow-x:hidden}

/* ── Top Bar ── */
.topbar{position:sticky;top:0;z-index:100;background:#0a0a1a;border-bottom:1px solid rgba(14,165,233,0.12);padding:0 32px;height:64px;display:flex;align-items:center;justify-content:space-between}
.topbar-back{display:flex;align-items:center;gap:8px;color:#6b7d94;font-size:14px;font-weight:600;text-decoration:none;padding:7px 14px;border-radius:8px;border:1px solid rgba(148,163,184,0.15);transition:all 0.2s}
.topbar-back:hover{border-color:rgba(56,189,248,0.4);color:#38bdf8;background:rgba(56,189,248,0.08)}
.topbar-brand{display:flex;align-items:center;gap:10px;text-decoration:none}
.topbar-brand b{font-family:Sora,sans-serif;font-size:18px;font-weight:800;color:#fff}
.topbar-brand b em{font-style:normal;color:#38bdf8}

/* ── Hero ── */
.hero{text-align:center;padding:36px 40px 24px;background:linear-gradient(135deg,#0284c7 0%,#0ea5e9 40%,#38bdf8 100%);border-radius:0 0 24px 24px;margin-bottom:20px}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);border-radius:999px;padding:6px 18px;font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;margin-bottom:16px}
.hero-badge::before{content:'';width:6px;height:6px;border-radius:50%;background:#fff;animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
.hero h1{font-family:Sora,sans-serif;font-size:clamp(22px,3.5vw,36px);font-weight:800;line-height:1.15;color:#fff;margin-bottom:8px}
.hero h1 span{color:#e0f2fe}
.hero p{font-size:15px;color:rgba(255,255,255,0.7);max-width:560px;margin:0 auto;line-height:1.6}

/* ── Tier bar ── */
.tier-bar{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;padding:14px 24px;background:#fff;border:1px solid var(--border);border-radius:14px;max-width:1200px;margin:0 auto 20px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.tier-btn{padding:8px 18px;border-radius:10px;border:none;background:transparent;color:#64748b;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s}
.tier-btn:hover{color:#0ea5e9;background:rgba(14,165,233,0.05)}
.tier-btn.active{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff;box-shadow:0 4px 14px rgba(14,165,233,0.3)}

/* ── Layout ── */
.main{display:grid;grid-template-columns:1fr 340px;gap:20px;max-width:1200px;margin:0 auto;padding:0 24px 80px}
@media(max-width:960px){.main{grid-template-columns:1fr}}

/* ── Cards ── */
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:22px;box-shadow:0 1px 4px rgba(0,40,100,0.04)}
.card-eye{font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:#38bdf8;margin-bottom:4px}
.card-ttl{font-size:17px;font-weight:800;color:#0f172a;margin-bottom:14px}

/* ── Controls ── */
.ctrls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
.btn{padding:10px 20px;border-radius:8px;border:none;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s}
.btn-play{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff;box-shadow:0 4px 14px rgba(14,165,233,0.3)}
.btn-play:hover{box-shadow:0 6px 24px rgba(0,212,255,0.4);transform:translateY(-1px)}
.btn-rst{background:#f8fafc;color:#64748b;border:1px solid var(--border)}
.btn-rst:hover{background:#f1f5f9;color:#0f172a}
.spd{display:flex;align-items:center;gap:8px;margin-left:auto}
.spd span{font-size:10px;color:#94a3b8;letter-spacing:1px;text-transform:uppercase}
input[type=range]{width:80px;accent-color:var(--cyan2);cursor:pointer}

/* ═══ TREE — centred, compact ═══ */
.tree-viewport{position:relative;overflow:hidden;border:1px solid var(--border);border-radius:12px;background:#f8fafc;margin-bottom:16px}
.tree-canvas{position:relative;min-height:520px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px 8px}
.tree-canvas svg{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
.tree-rows{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;gap:36px}
/* Flow trail — animated dot that travels up the tree on pass-up */
.flow-dot{position:absolute;width:10px;height:10px;border-radius:50%;background:var(--gold);box-shadow:0 0 12px rgba(245,158,11,0.6),0 0 24px rgba(245,158,11,0.3);z-index:20;pointer-events:none;opacity:0}
.flow-dot.active{animation:flowTravel var(--dur,0.8s) ease-in-out forwards}
@keyframes flowTravel{0%{opacity:1;offset-distance:0%}85%{opacity:1}100%{opacity:0;offset-distance:100%}}
.tree-row{display:flex;justify-content:center;gap:6px}

/* Row labels */
.row-label{position:absolute;left:8px;font-size:8px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#94a3b8;top:50%;transform:translateY(-50%);white-space:nowrap}

/* Nodes */
.nd{
  width:58px;height:44px;border-radius:8px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  text-align:center;position:relative;cursor:default;
  background:#e8f4fd;border:1.5px solid rgba(14,165,233,0.25);color:#0f172a;
  transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);overflow:visible;
}
.nd .nm{font-size:9px;font-weight:800;line-height:1.1;color:#1e3a5f}
.nd .sc{font-size:7px;font-weight:600;color:#64889a;margin-top:1px}
.nd .badge{position:absolute;top:-7px;right:-7px;width:16px;height:16px;border-radius:50%;font-size:8px;font-weight:800;display:none;align-items:center;justify-content:center;z-index:3;line-height:1;box-shadow:0 2px 6px rgba(0,0,0,0.15)}

/* Sponsor (above YOU) */
.nd.sponsor{
  background:linear-gradient(135deg,#6366f1,#4f46e5);border:2.5px solid #818cf8;color:#fff;
  width:66px;height:50px;border-style:solid;
  box-shadow:0 4px 16px rgba(99,102,241,0.3),0 0 0 3px rgba(99,102,241,0.1);
}
.nd.sponsor .nm{font-size:10px;color:#fff;font-family:Sora,sans-serif}
.nd.sponsor .sc{color:rgba(255,255,255,0.6)}

/* Root (YOU — mid-tree affiliate) */
.nd.root{
  background:linear-gradient(135deg,#0ea5e9,#0284c7);border:2.5px solid var(--cyan);color:#fff;
  width:70px;height:54px;border-style:solid;
  box-shadow:0 4px 20px rgba(14,165,233,0.35),0 0 0 4px rgba(14,165,233,0.1);
}
.nd.root .nm{font-size:13px;color:#fff;font-family:Sora,sans-serif}
.nd.root .sc{color:rgba(255,255,255,0.7)}

/* States */
.nd.selling{border-color:#10b981!important;border-style:solid!important;background:rgba(16,185,129,0.1)!important;box-shadow:0 0 12px rgba(16,185,129,0.15)!important}
.nd.keeping{border-color:#10b981!important;border-style:solid!important;background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(16,185,129,0.15))!important;box-shadow:0 0 18px rgba(16,185,129,0.25)!important;animation:pulse .45s ease}
.nd.receiving{border-color:var(--gold)!important;border-style:solid!important;background:linear-gradient(135deg,rgba(245,158,11,0.06),rgba(245,158,11,0.12))!important;box-shadow:0 0 18px rgba(245,158,11,0.25)!important;animation:pulse .45s ease}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
@keyframes nodeAppear{0%{opacity:0;transform:scale(0.3)}60%{transform:scale(1.1)}100%{opacity:1;transform:scale(1)}}
.nd.keeping .nm{color:#065f46!important}.nd.receiving .nm{color:#92400e!important}

/* Float */
.cfloat{position:absolute;font-size:13px;font-weight:800;pointer-events:none;z-index:10;white-space:nowrap;left:50%;animation:fUp 1.1s ease-out forwards}
@keyframes fUp{0%{opacity:1;top:-8px;transform:translateX(-50%)}100%{opacity:0;top:-36px;transform:translateX(-50%)}}

/* Flow arrow for pass-up */
.flow-arrow{position:absolute;z-index:5;pointer-events:none;animation:flowPulse 0.6s ease-out forwards}
@keyframes flowPulse{0%{opacity:0;transform:scale(0.5)}30%{opacity:1;transform:scale(1.1)}100%{opacity:0;transform:scale(1)}}

/* Legend */
.legend{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:16px}
.lg-i{display:flex;align-items:center;gap:6px;font-size:11px;color:#64748b}
.lg-s{width:14px;height:14px;border-radius:4px;flex-shrink:0}

/* ═══ CALCULATOR PANEL ═══ */
.calc-panel{background:rgba(14,165,233,0.03);border:1px solid rgba(14,165,233,0.12);border-radius:12px;padding:18px;margin-bottom:16px}
.calc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.calc-label{font-size:14px;font-weight:700;color:#0f172a}
.calc-sub{font-size:12px;color:#64748b;margin-top:2px}
.calc-big{font-size:36px;font-weight:800;line-height:1}
.calc-cap{font-size:11px;color:#94a3b8}
.calc-slider{width:100%;accent-color:var(--cyan2);margin:8px 0}
.calc-range{display:flex;justify-content:space-between;font-size:10px;color:#94a3b8;margin-bottom:6px}
.calc-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
.calc-stat{background:#fff;border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center}
.calc-stat-val{font-size:20px;font-weight:800;margin-bottom:2px}
.calc-stat-lbl{font-size:10px;color:#64748b;font-weight:600}

/* How-strip */
.how-strip{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
@media(max-width:700px){.how-strip{grid-template-columns:repeat(2,1fr)}}
.how-s{background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.how-s .hn{width:24px;height:24px;border-radius:6px;display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;margin-bottom:5px}
.how-s .ht{font-size:12px;font-weight:700;color:#0f172a;margin-bottom:2px}
.how-s .hd{font-size:10px;color:#64748b;line-height:1.45}

/* ── Right Col ── */
.right-col{display:flex;flex-direction:column;gap:14px}
.eye{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#38bdf8;margin-bottom:12px}
.e-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f1f5f9}
.e-row:last-child{border-bottom:none}
.e-left{display:flex;align-items:center;gap:10px}
.e-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.e-lbl{font-size:13px;font-weight:600;color:#334155}
.e-sub{font-size:11px;color:#94a3b8;margin-top:1px}
.e-amt{font-size:18px;font-weight:700;text-align:right}
.e-amt.bump{animation:nb .25s ease}
@keyframes nb{0%,100%{transform:scale(1)}50%{transform:scale(1.18)}}

.tot-card{background:linear-gradient(135deg,#0284c7,#0ea5e9,#38bdf8);border:none;border-radius:14px;padding:20px;text-align:center;color:#fff}
.tot-lbl{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.6);margin-bottom:4px}
.tot-amt{font-size:32px;font-weight:800;color:#fff}
.tot-sub{font-size:12px;color:rgba(255,255,255,0.55);margin-top:4px}

/* Split */
.sp-bar{display:flex;height:8px;border-radius:99px;overflow:hidden;gap:2px;margin:10px 0 12px}
.sp-seg{border-radius:3px}
.sp-leg{display:flex;flex-direction:column;gap:6px}
.sp-i{display:flex;align-items:center;gap:8px;font-size:12px;color:#64748b}
.sp-sw{width:8px;height:8px;border-radius:2px;flex-shrink:0}
.sp-v{margin-left:auto;font-weight:700}

/* Info */
.i-ttl{font-size:13px;font-weight:700;color:#0f172a;margin-bottom:10px}
.i-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #f1f5f9;font-size:12px}
.i-row:last-child{border-bottom:none}
.i-k{color:#64748b}.i-v{font-weight:700}

/* Log */
.log-ls{display:flex;flex-direction:column;max-height:200px;overflow-y:auto}
.log-it{display:flex;align-items:center;font-size:11px;color:#64748b;padding:4px 0;border-bottom:1px solid #f8fafc;animation:sIn .2s ease}
.log-it:last-child{border-bottom:none}
@keyframes sIn{from{opacity:0;transform:translateX(-4px)}to{opacity:1;transform:none}}
.log-l{display:flex;align-items:center;gap:6px;min-width:0}
.log-w{font-weight:700;color:#334155;min-width:36px}
.log-s{color:#94a3b8;font-size:10px}
.log-t{font-size:8px;padding:2px 5px;border-radius:3px;font-weight:700;letter-spacing:.5px;white-space:nowrap}
.log-t.kept{color:#10b981;border:1px solid rgba(16,185,129,.25);background:rgba(16,185,129,.06)}
.log-t.passup{color:var(--gold);border:1px solid rgba(245,158,11,.25);background:rgba(245,158,11,.06)}
.log-a{font-weight:700;font-size:11px;white-space:nowrap;margin-left:auto;font-variant-numeric:tabular-nums}

/* Mobile */
.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:rgba(2,8,24,.97);border-top:1px solid rgba(14,165,233,.12);z-index:200;backdrop-filter:blur(12px);padding:6px 0 max(6px,env(safe-area-inset-bottom))}
.mob-nav-in{display:flex;justify-content:space-around;max-width:480px;margin:0 auto}
.mob-i{display:flex;flex-direction:column;align-items:center;gap:2px;text-decoration:none;padding:4px 8px;font-size:10px;color:#64748b}
.mob-i.on{color:#38bdf8}
@media(max-width:768px){.mob-nav{display:block}body{padding-bottom:72px}.main{padding:0 12px 80px;grid-template-columns:1fr}.topbar b{font-size:15px}}
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <a href="/dashboard" class="topbar-back">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
    Dashboard
  </a>
  <a href="/" class="topbar-brand">
    <svg width="32" height="32" viewBox="0 0 44 44"><circle cx="22" cy="22" r="20" fill="url(#sg)"/><path d="M18 13l14 9-14 9V13z" fill="#fff"/><defs><linearGradient id="sg" x1="0" y1="0" x2="44" y2="44" gradientUnits="userSpaceOnUse"><stop stop-color="#0ea5e9"/><stop offset="1" stop-color="#38bdf8"/></linearGradient></defs></svg>
    <b>Super<em>Ad</em>Pro</b>
  </a>
</div>

<!-- Hero -->
<div class="hero">
  <div class="hero-badge">Stream 03 — Course Commissions</div>
  <h1>Infinite Pass-Up <span>Visualiser</span></h1>
  <p>Watch 100% course commissions cascade through your team. Your <strong style="color:#fff">2nd, 4th &amp; 6th</strong> sales pass up — everything else you keep forever.</p>
</div>

<!-- Tier Bar -->
<div class="tier-bar">
  <button class="tier-btn active" data-price="100" onclick="selTier(this)">$100 Starter</button>
  <button class="tier-btn" data-price="300" onclick="selTier(this)">$300 Advanced</button>
  <button class="tier-btn" data-price="500" onclick="selTier(this)">$500 Elite</button>
</div>

<div class="main">
  <!-- ═══ LEFT ═══ -->
  <div class="card">
    <div class="card-eye">Stream 03 — Course Pass-Up</div>
    <div class="card-ttl" id="panelTtl">INFINITE PASS-UP — $100 STARTER</div>

    <div class="ctrls">
      <button class="btn btn-play" id="playBtn" onclick="togglePlay()">▶ PLAY</button>
      <button class="btn btn-rst" onclick="resetSim()">↺ RESET</button>
      <div class="spd"><span>Speed</span><input type="range" min="1" max="5" value="3" id="spdSlider"></div>
    </div>

    <!-- TREE — focused 3-level view -->
    <div class="tree-viewport">
      <div class="tree-canvas" id="treeCanvas">
        <svg id="treeSvg" width="100%" height="100%"></svg>
        <div class="tree-rows" id="treeRows"></div>
      </div>
    </div>

    <!-- Legend -->
    <div class="legend">
      <div class="lg-i"><div class="lg-s" style="background:linear-gradient(135deg,#6366f1,#4f46e5);border:2px solid #818cf8"></div>Your Sponsor</div>
      <div class="lg-i"><div class="lg-s" style="background:linear-gradient(135deg,#0ea5e9,#0284c7);border:2px solid var(--cyan)"></div>You</div>
      <div class="lg-i"><div class="lg-s" style="background:#f0f9ff;border:1.5px solid rgba(14,165,233,.3)"></div>Active Member</div>
      <div class="lg-i"><div class="lg-s" style="background:rgba(16,185,129,.12);border:1.5px solid var(--green)"></div>Keeps Commission</div>
      <div class="lg-i"><div class="lg-s" style="background:rgba(245,158,11,.1);border:1.5px solid var(--gold)"></div>Pass-Up to Sponsor</div>
    </div>

    <!-- Earnings Calculator -->
    <div class="calc-panel">
      <div class="calc-top">
        <div>
          <div class="calc-label">Your Direct Referrals</div>
          <div class="calc-sub">Each referral sells courses &amp; their team pass up to you</div>
        </div>
        <div style="text-align:right">
          <div class="calc-big" id="calcDirectBig" style="color:var(--green)">6</div>
          <div class="calc-cap">personal referrals</div>
        </div>
      </div>
      <input type="range" class="calc-slider" min="1" max="20" value="6" id="calcDirect" oninput="updateCalc()">
      <div class="calc-range"><span>1 referral</span><span>10 referrals</span><span>20 referrals</span></div>

      <div class="calc-top" style="margin-top:10px">
        <div>
          <div class="calc-label">Avg Sales Per Member</div>
          <div class="calc-sub">How many course sales each person in your team makes</div>
        </div>
        <div style="text-align:right">
          <div class="calc-big" id="calcSalesBig" style="color:var(--cyan2)">6</div>
          <div class="calc-cap">sales each</div>
        </div>
      </div>
      <input type="range" class="calc-slider" min="1" max="12" value="6" id="calcSales" oninput="updateCalc()">
      <div class="calc-range"><span>1 sale</span><span>6 sales</span><span>12 sales</span></div>

      <div class="calc-grid">
        <div class="calc-stat"><div class="calc-stat-val" id="csKept" style="color:var(--green)">$0</div><div class="calc-stat-lbl">You Keep (1,3,5,7+)</div></div>
        <div class="calc-stat"><div class="calc-stat-val" id="csL1" style="color:var(--gold)">$0</div><div class="calc-stat-lbl">From L1 Directs</div></div>
        <div class="calc-stat"><div class="calc-stat-val" id="csL2" style="color:var(--gold)">$0</div><div class="calc-stat-lbl">From L2 (Cascade)</div></div>
        <div class="calc-stat"><div class="calc-stat-val" id="csL3" style="color:var(--gold)">$0</div><div class="calc-stat-lbl">From L3+ (Cascade)</div></div>
      </div>
      <div class="calc-stat" style="margin-top:10px;background:linear-gradient(135deg,#0284c7,#0ea5e9);border:none;color:#fff">
        <div class="calc-stat-val" id="csTotal" style="color:#fff;font-size:24px">$0</div>
        <div class="calc-stat-lbl" style="color:rgba(255,255,255,0.7)">Total Estimated Earnings · <span id="csTeam">0</span> team members</div>
      </div>
    </div>

    <!-- How it works -->
    <div class="how-strip">
      <div class="how-s"><div class="hn" style="background:rgba(14,165,233,.1);color:var(--cyan2)">1</div><div class="ht">Refer &amp; Sell</div><div class="hd">Refer someone who buys a course — that's your sale</div></div>
      <div class="how-s"><div class="hn" style="background:rgba(16,185,129,.1);color:var(--green)">2</div><div class="ht">Keep 100%</div><div class="hd">Sales 1, 3, 5, 7+ you keep the full commission</div></div>
      <div class="how-s"><div class="hn" style="background:rgba(245,158,11,.1);color:var(--gold)">3</div><div class="ht">Pass Up 3</div><div class="hd">Your 2nd, 4th &amp; 6th sales pass 100% to your sponsor</div></div>
      <div class="how-s"><div class="hn" style="background:rgba(124,58,237,.1);color:#8b5cf6">4</div><div class="ht">Infinite Depth</div><div class="hd">Pass-ups cascade through every level of your team</div></div>
    </div>
  </div>

  <!-- ═══ RIGHT ═══ -->
  <div class="right-col">
    <div class="card">
      <div class="eye">Live Earnings Tracker</div>
      <div class="e-row">
        <div class="e-left"><div class="e-dot" style="background:var(--green)"></div><div><div class="e-lbl">Direct Sales Kept</div><div class="e-sub">Your sales 1, 3, 5, 7+</div></div></div>
        <div class="e-amt" id="keptAmt" style="color:#10b981">$0</div>
      </div>
      <div class="e-row">
        <div class="e-left"><div class="e-dot" style="background:var(--gold)"></div><div><div class="e-lbl">Pass-Ups Received</div><div class="e-sub">Team's 2nd, 4th, 6th</div></div></div>
        <div class="e-amt" id="passupAmt" style="color:var(--gold)">$0</div>
      </div>
    </div>

    <div class="tot-card">
      <div class="tot-lbl">Your Total This Round</div>
      <div class="tot-amt" id="totalAmt">$0</div>
      <div class="tot-sub"><span id="kc">0</span> kept · <span id="pc">0</span> pass-ups</div>
    </div>

    <div class="card">
      <div class="eye">Per Sale — $<span id="spPrice">100</span></div>
      <div class="sp-bar"><div class="sp-seg" style="flex:4;background:var(--green)"></div><div class="sp-seg" style="flex:3;background:var(--gold)"></div></div>
      <div class="sp-leg">
        <div class="sp-i"><div class="sp-sw" style="background:var(--green)"></div>You keep (1,3,5,7+)<span class="sp-v" id="spK" style="color:#10b981">$100</span></div>
        <div class="sp-i"><div class="sp-sw" style="background:var(--gold)"></div>Passes up (2,4,6)<span class="sp-v" id="spP" style="color:var(--gold)">$100</span></div>
      </div>
    </div>

    <div class="card">
      <div class="i-ttl">Simulation Stats</div>
      <div class="i-row"><span class="i-k">Course tier</span><span class="i-v" id="iTier" style="color:var(--cyan2)">$100 Starter</span></div>
      <div class="i-row"><span class="i-k">Total team sales</span><span class="i-v" id="iTotal" style="color:var(--cyan2)">0</span></div>
      <div class="i-row"><span class="i-k">Your personal sales</span><span class="i-v" id="iDirect" style="color:var(--green)">0</span></div>
      <div class="i-row"><span class="i-k">Pass-ups received</span><span class="i-v" id="iPassups" style="color:var(--gold)">0</span></div>
    </div>

    <div class="card">
      <div class="eye" style="font-size:10px;margin-bottom:8px">Activity Log</div>
      <div class="log-ls" id="logList">
        <div class="log-it"><span style="color:#94a3b8;font-size:11px">Press PLAY to start…</span></div>
      </div>
    </div>
  </div>
</div>
<script>
/* ═══ PROGRESSIVE PASS-UP ENGINE ═══
   Nodes appear one-by-one as they're sponsored.
   Each new member buys a course → commission flows visually. */

let tier=100;
const PU=new Set([2,4,6]);
const NM=['Alex','Beth','Carl','Dana','Eric','Faye','Gina','Hugo','Iris','Jake','Kate','Leo','Mia','Nate','Olga','Paul','Quinn','Rosa','Sam','Tina'];
let allNodes=[],nMap={},playing=false,tmr=null,steps=[],si=0;
let tK=0,tP=0,nK=0,nP=0,tS=0;
let youId=1,sponsorId=0;

/* Pre-build full tree data (all hidden initially) */
function buildTree(){
  allNodes=[];nMap={};let id=0,ni=0;
  function mk(nm,pid,cls){const n={id:id++,nm,pid,pu:null,sc:0,rc:0,ch:[],el:null,cls:cls||'',visible:false,saleType:null};allNodes.push(n);nMap[n.id]=n;return n;}

  const sp=mk('SPONSOR',null,'sponsor'); sp.visible=true;
  const you=mk('YOU',sp.id,'root'); sp.ch.push(you.id); sp.rc++;
  you.pu=sp.id; you.visible=true;
  youId=you.id; sponsorId=sp.id;

  // YOUR 7 direct referrals
  for(let i=0;i<7;i++){
    const c=mk(NM[ni++],you.id);you.ch.push(c.id);you.rc++;
    c.pu=PU.has(you.rc)?you.pu:you.id;
  }

  // First 4 directs each get 3 referrals (L2)
  for(const cid of you.ch.slice(0,4)){
    const p=nMap[cid];
    for(let i=0;i<3;i++){
      const c=mk(NM[ni++%NM.length],p.id);p.ch.push(c.id);p.rc++;
      c.pu=PU.has(p.rc)?p.pu:p.id;
    }
  }

  // First 6 L2 members each get 2 referrals (L3 — shows deeper cascade)
  const l2all=allNodes.filter(n=>n.pid!==null&&nMap[n.pid]&&nMap[n.pid].pid===you.id);
  for(const l2 of l2all.slice(0,6)){
    for(let j=0;j<2;j++){
      const c=mk(NM[ni++%NM.length],l2.id);l2.ch.push(c.id);l2.rc++;
      c.pu=PU.has(l2.rc)?l2.pu:l2.id;
    }
  }
}

/* Build step queue — each step reveals a new member */
function buildSteps(){
  steps=[];
  const you=nMap[youId];

  // Phase 1: YOUR 7 directs join one by one
  for(const cid of you.ch){
    steps.push({nodeId:cid,spId:youId});
  }

  // Phase 2: First 4 directs recruit — interleaved rotation
  for(let round=0;round<3;round++){
    for(const did of you.ch.slice(0,4)){
      const d=nMap[did];
      if(d.ch[round]!==undefined) steps.push({nodeId:d.ch[round],spId:did});
    }
  }

  // Phase 3: L2 members recruit — shows 3+ level cascade
  const l2all=allNodes.filter(n=>n.pid!==null&&nMap[n.pid]&&nMap[n.pid].pid===youId);
  for(let round=0;round<2;round++){
    for(const l2 of l2all.slice(0,6)){
      if(l2.ch[round]!==undefined) steps.push({nodeId:l2.ch[round],spId:l2.id});
    }
  }
}

/* Render only visible nodes */
function renderTree(){
  const rows=document.getElementById('treeRows');rows.innerHTML='';
  const levels={};
  allNodes.forEach(n=>{
    if(!n.visible)return;
    const lv=getLevel(n);
    if(!levels[lv])levels[lv]=[];
    levels[lv].push(n);
  });
  const maxLv=Math.max(...Object.keys(levels).map(Number),0);
  for(let lv=0;lv<=maxLv;lv++){
    const lns=levels[lv]||[];
    if(!lns.length)continue;
    const row=document.createElement('div');row.className='tree-row';
    lns.forEach(n=>{
      const el=document.createElement('div');
      el.className='nd'+(n.cls?' '+n.cls:'');el.id='n'+n.id;
      el.innerHTML='<div class="nm">'+n.nm+'</div><div class="sc" id="sc'+n.id+'">'+n.sc+' sale'+(n.sc!==1?'s':'')+'</div><div class="badge" id="pb'+n.id+'"></div>';
      // Apply persistent colour based on sale type
      if(n.saleType==='kept'){
        el.style.background='#d1fae5';el.style.borderColor='#10b981';el.style.borderStyle='solid';
        el.querySelector('.nm').style.color='#065f46';
        el.querySelector('.sc').style.color='#047857';
      } else if(n.saleType==='passup'){
        el.style.background='#fef3c7';el.style.borderColor='#f59e0b';el.style.borderStyle='solid';
        el.querySelector('.nm').style.color='#92400e';
        el.querySelector('.sc').style.color='#b45309';
      }
      row.appendChild(el);n.el=el;
    });
    rows.appendChild(row);
  }
  requestAnimationFrame(function(){requestAnimationFrame(drawLines);});
}

function getLevel(n){var lv=0,cur=n;while(cur.pid!==null){lv++;cur=nMap[cur.pid];}return lv;}

function drawLines(){
  var svg=document.getElementById('treeSvg');
  var cv=document.getElementById('treeCanvas');
  var cr=cv.getBoundingClientRect();
  svg.setAttribute('width',cv.scrollWidth);svg.setAttribute('height',cv.scrollHeight);svg.innerHTML='';
  allNodes.forEach(function(n){
    if(!n.visible||n.pid===null||!n.el)return;
    var p=nMap[n.pid];if(!p||!p.visible||!p.el)return;
    var pr=p.el.getBoundingClientRect(),nr=n.el.getBoundingClientRect();
    var x1=pr.left+pr.width/2-cr.left,y1=pr.top+pr.height-cr.top;
    var x2=nr.left+nr.width/2-cr.left,y2=nr.top-cr.top;
    var my=(y1+y2)/2;
    var path=document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d','M'+x1+','+y1+' C'+x1+','+my+' '+x2+','+my+' '+x2+','+y2);
    path.setAttribute('fill','none');path.setAttribute('stroke','#cbd5e1');path.setAttribute('stroke-width','1.5');
    path.id='ln'+n.pid+'-'+n.id;svg.appendChild(path);
  });
}

/* ═══ PROCESS STEP ═══ */
function processStep(){
  if(si>=steps.length){pause();addLog('✅','','Simulation complete!','#38bdf8','kept');return;}
  var step=steps[si++];
  var nn=nMap[step.nodeId];
  var sp=nMap[step.spId];
  if(!nn||!sp)return;

  // 1. Reveal the new node
  nn.visible=true;
  renderTree();
  if(nn.el) nn.el.style.animation='nodeAppear 0.5s cubic-bezier(0.34,1.56,0.64,1)';

  // 2. Sponsor gets a sale (new member bought a course)
  sp.sc++; tS++;
  var sn=sp.sc;
  var isUp=PU.has(sn);
  var sce=document.getElementById('sc'+sp.id);
  if(sce) sce.textContent=sn+(sn===1?' sale':' sales');

  // 3. Colour the new node based on sale type and store it
  if(isUp){
    nn.saleType='passup';
  } else {
    nn.saleType='kept';
  }
  // Apply colour immediately (renderTree will also apply on re-render)
  if(nn.el){
    if(nn.saleType==='passup'){
      nn.el.style.background='#fef3c7';nn.el.style.borderColor='#f59e0b';nn.el.style.borderStyle='solid';
      nn.el.querySelector('.nm').style.color='#92400e';
      nn.el.querySelector('.sc').style.color='#b45309';
    } else {
      nn.el.style.background='#d1fae5';nn.el.style.borderColor='#10b981';nn.el.style.borderStyle='solid';
      nn.el.querySelector('.nm').style.color='#065f46';
      nn.el.querySelector('.sc').style.color='#047857';
    }
  }

  // 3. After brief pause, show the commission flow
  setTimeout(function(){
    if(isUp){
      // PASS-UP: find recipient via pass-up sponsor chain
      var rec=sp.pu!=null?nMap[sp.pu]:null;
      if(!rec) rec=nMap[sponsorId];

      var bd=document.getElementById('pb'+sp.id);
      if(bd){bd.style.display='flex';bd.style.background='var(--gold)';bd.style.color='#fff';bd.textContent='↑';}

      // Build flow path from sponsor UP to recipient
      var flowPath=[];
      var cur=sp;
      while(cur&&cur.id!==rec.id){flowPath.push(cur);if(cur.pid===null)break;cur=nMap[cur.pid];}
      flowPath.push(rec);

      // Highlight connector lines along path
      for(var i=0;i<flowPath.length-1;i++){
        var from=flowPath[i];
        var ln=document.getElementById('ln'+from.pid+'-'+from.id);
        if(ln){ln.setAttribute('stroke','#f59e0b');ln.setAttribute('stroke-width','2.5');ln.setAttribute('stroke-dasharray','5 3');}
      }

      if(sp.el){sp.el.classList.add('selling');setTimeout(function(){sp.el.classList.remove('selling');},700);}
      animateFlowTrail(flowPath);
      if(rec.el){rec.el.classList.add('receiving');setTimeout(function(){rec.el.classList.remove('receiving');},800+(flowPath.length*280));}
      setTimeout(function(){if(rec.el)showFloat(rec.el,'+$'+tier,'#f59e0b');},flowPath.length*250);

      if(rec.id===youId){tP+=tier;nP++;}
      addLog(nn.nm+' joins','Sale #'+sn,'↑ PASS-UP to '+rec.nm,'#f59e0b','passup');
    } else {
      // KEPT: sponsor keeps the commission
      if(sp.el){sp.el.classList.add('keeping');setTimeout(function(){sp.el.classList.remove('keeping');},700);}
      if(sp.el) showFloat(sp.el,'+$'+tier,'#10b981');

      var bd=document.getElementById('pb'+sp.id);
      if(bd&&sn<=7){bd.style.display='flex';bd.style.background='var(--green)';bd.style.color='#fff';bd.textContent='✓';}

      if(sp.id===youId){tK+=tier;nK++;}
      addLog(nn.nm+' joins','Sale #'+sn,'KEPT ✓ by '+sp.nm,'#10b981','kept');
    }
    updateUI();
  },600);
}

/* Flow trail animation */
function animateFlowTrail(path){
  if(path.length<2)return;
  var cv=document.getElementById('treeCanvas');
  var cr=cv.getBoundingClientRect();
  for(var i=0;i<path.length-1;i++){
    (function(idx){
      setTimeout(function(){
        var from=path[idx].el,to=path[idx+1].el;
        if(!from||!to)return;
        var fr=from.getBoundingClientRect(),tr=to.getBoundingClientRect();
        var x1=fr.left+fr.width/2-cr.left,y1=fr.top+fr.height/2-cr.top;
        var x2=tr.left+tr.width/2-cr.left,y2=tr.top+tr.height/2-cr.top;
        var dot=document.createElement('div');
        dot.style.cssText='position:absolute;width:10px;height:10px;border-radius:50%;background:var(--gold);box-shadow:0 0 12px rgba(245,158,11,0.7),0 0 24px rgba(245,158,11,0.3);z-index:20;pointer-events:none;left:'+(x1-5)+'px;top:'+(y1-5)+'px;';
        cv.appendChild(dot);
        var dx=x2-x1,dy=y2-y1,dur=300;
        dot.animate([{transform:'translate(0,0)',opacity:1},{transform:'translate('+dx+'px,'+dy+'px)',opacity:1}],{duration:dur,easing:'ease-in-out',fill:'forwards'});
        if(idx<path.length-2&&path[idx+1].el){
          setTimeout(function(){
            path[idx+1].el.style.boxShadow='0 0 16px rgba(245,158,11,0.4)';
            setTimeout(function(){path[idx+1].el.style.boxShadow='';},400);
          },dur-50);
        }
        setTimeout(function(){dot.remove();},dur+100);
      },idx*280);
    })(i);
  }
}

function showFloat(el,t,c){var f=document.createElement('div');f.className='cfloat';f.textContent=t;f.style.color=c;el.appendChild(f);setTimeout(function(){f.remove();},1200);}

function updateUI(){
  bump('keptAmt','$'+tK.toLocaleString());bump('passupAmt','$'+tP.toLocaleString());
  document.getElementById('totalAmt').textContent='$'+(tK+tP).toLocaleString();
  document.getElementById('kc').textContent=nK;document.getElementById('pc').textContent=nP;
  document.getElementById('iTotal').textContent=tS;document.getElementById('iDirect').textContent=nMap[youId].sc;
  document.getElementById('iPassups').textContent=nP;
}
function bump(id,v){var e=document.getElementById(id);e.textContent=v;e.classList.remove('bump');void e.offsetWidth;e.classList.add('bump');}

function addLog(who,sale,act,col,type){
  var l=document.getElementById('logList');
  if(l.querySelector('[style*="94a3b8"]'))l.innerHTML='';
  var it=document.createElement('div');it.className='log-it';
  it.innerHTML='<div class="log-l"><span class="log-w">'+who+'</span><span class="log-s">'+sale+'</span><span class="log-t '+type+'">'+act+'</span></div><span class="log-a" style="color:'+col+'">$'+tier+'</span>';
  l.insertBefore(it,l.firstChild);while(l.children.length>14)l.removeChild(l.lastChild);
}

/* Controls */
function togglePlay(){playing?pause():play();}
function play(){playing=true;document.getElementById('playBtn').textContent='⏸ PAUSE';tick();}
function pause(){playing=false;clearTimeout(tmr);document.getElementById('playBtn').textContent='▶ PLAY';}
function getDelay(){return Math.round(2800-(parseInt(document.getElementById('spdSlider').value)-1)*480);}
function tick(){if(!playing)return;processStep();if(si<steps.length)tmr=setTimeout(tick,getDelay());else pause();}

function selTier(btn){
  document.querySelectorAll('.tier-btn').forEach(function(b){b.classList.remove('active');});btn.classList.add('active');
  tier=parseInt(btn.dataset.price);var lb=tier===100?'STARTER':tier===300?'ADVANCED':'ELITE';
  document.getElementById('panelTtl').textContent='INFINITE PASS-UP — $'+tier+' '+lb;
  document.getElementById('iTier').textContent='$'+tier+' '+lb.charAt(0)+lb.slice(1).toLowerCase();
  document.getElementById('spPrice').textContent=tier;document.getElementById('spK').textContent='$'+tier;document.getElementById('spP').textContent='$'+tier;
  updateCalc();resetSim();
}

function resetSim(){
  pause();tK=0;tP=0;nK=0;nP=0;tS=0;si=0;
  buildTree();buildSteps();
  allNodes.forEach(function(n){n.sc=0;n.el=null;});
  nMap[sponsorId].visible=true;nMap[youId].visible=true;
  renderTree();updateUI();
  document.getElementById('logList').innerHTML='<div class="log-it"><span style="color:#94a3b8;font-size:11px">Press PLAY — watch your team build…</span></div>';
  document.getElementById('playBtn').textContent='▶ PLAY';
}

/* ═══ CALCULATOR ═══ */
function updateCalc(){
  var directs=parseInt(document.getElementById('calcDirect').value);
  var salesPer=parseInt(document.getElementById('calcSales').value);
  document.getElementById('calcDirectBig').textContent=directs;
  document.getElementById('calcSalesBig').textContent=salesPer;

  function keptCount(n){var k=0;for(var i=1;i<=n;i++){if(!PU.has(i))k++;}return k;}
  function passCount(n){return n-keptCount(n);}

  var youKept=keptCount(salesPer)*tier;
  var l1Passups=directs*passCount(salesPer)*tier;

  var l2YouCount=0;
  for(var d=0;d<directs;d++){for(var pos=1;pos<=directs;pos++){if(PU.has(pos))l2YouCount++;}}
  var l2Passups=l2YouCount*passCount(salesPer)*tier;

  var l3Total=directs*directs*directs;
  var l3Passups=Math.floor(l3Total*0.3)*passCount(salesPer)*tier;

  var totalPassups=l1Passups+l2Passups+l3Passups;
  var totalEarnings=youKept+totalPassups;
  var teamSize=1+directs+(directs*directs)+l3Total;

  document.getElementById('csKept').textContent='$'+youKept.toLocaleString();
  document.getElementById('csL1').textContent='$'+l1Passups.toLocaleString();
  document.getElementById('csL2').textContent='$'+l2Passups.toLocaleString();
  document.getElementById('csL3').textContent='$'+l3Passups.toLocaleString();
  document.getElementById('csTotal').textContent='$'+totalEarnings.toLocaleString();
  document.getElementById('csTeam').textContent=teamSize.toLocaleString();
}

/* Init */
resetSim();updateCalc();
window.addEventListener('resize',function(){requestAnimationFrame(drawLines);});
</script>

<div class="mob-nav"><div class="mob-nav-in">
  <a href="/dashboard" class="mob-i">⊞ Home</a>
  <a href="/watch" class="mob-i">▶ Watch</a>
  <a href="/income-grid" class="mob-i">⚡ Grid</a>
  <a href="/wallet" class="mob-i">◎ Wallet</a>
  <a href="/passup-visualiser" class="mob-i on">↑ Pass-Up</a>
</div></div>
</body>
</html>
