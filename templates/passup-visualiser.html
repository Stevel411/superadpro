<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pass-Up Visualiser — SuperAdPro</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@700;800&family=DM+Sans:wght@400;500;600;700;800&family=Rethink+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--cyan:#38bdf8;--cyan2:#0ea5e9;--green:#10b981;--gold:#f59e0b;--bg:#f0f2f8;--border:#e2e8f0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans','Rethink Sans',sans-serif;background:var(--bg);color:#0f172a;min-height:100vh;overflow-x:hidden}

/* ── Top Bar (matches internal grid) ── */
.topbar{position:sticky;top:0;z-index:100;background:#0a0a1a;border-bottom:1px solid rgba(14,165,233,0.12);padding:0 32px;height:64px;display:flex;align-items:center;justify-content:space-between}
.topbar-back{display:flex;align-items:center;gap:8px;color:#6b7d94;font-size:14px;font-weight:600;text-decoration:none;padding:7px 14px;border-radius:8px;border:1px solid rgba(148,163,184,0.15);transition:all 0.2s}
.topbar-back:hover{border-color:rgba(56,189,248,0.4);color:#38bdf8;background:rgba(56,189,248,0.08)}
.topbar-brand{display:flex;align-items:center;gap:10px;text-decoration:none}
.topbar-brand-text{font-family:Sora,sans-serif;font-size:18px;font-weight:800;color:#fff}
.topbar-brand-text em{font-style:normal;color:#38bdf8}

/* ── Hero ── */
.hero{text-align:center;padding:36px 40px 24px;background:linear-gradient(135deg,#0284c7 0%,#0ea5e9 40%,#38bdf8 100%);border-radius:0 0 24px 24px;margin-bottom:20px}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);border-radius:999px;padding:6px 18px;font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;margin-bottom:16px}
.hero-badge::before{content:'';width:6px;height:6px;border-radius:50%;background:#fff;animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
.hero h1{font-family:Sora,sans-serif;font-size:clamp(22px,3.5vw,36px);font-weight:800;line-height:1.15;color:#fff;margin-bottom:8px}
.hero h1 span{color:#e0f2fe}
.hero p{font-size:15px;color:rgba(255,255,255,0.7);max-width:560px;margin:0 auto;line-height:1.6}

/* ── Tier bar ── */
.tier-bar{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;padding:14px 24px;background:#fff;border:1px solid var(--border);border-radius:14px;max-width:1200px;margin:0 auto 20px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.tier-btn{padding:8px 18px;border-radius:10px;border:none;background:transparent;color:#64748b;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s}
.tier-btn:hover{color:#0ea5e9;background:rgba(14,165,233,0.05)}
.tier-btn.active{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff;box-shadow:0 4px 14px rgba(14,165,233,0.3)}

/* ── Layout ── */
.main{display:grid;grid-template-columns:1fr 320px;gap:20px;max-width:1200px;margin:0 auto;padding:0 24px 80px}
@media(max-width:900px){.main{grid-template-columns:1fr}}

/* ── Card base ── */
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:22px;box-shadow:0 1px 4px rgba(0,40,100,0.04)}
.card-eyebrow{font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:#38bdf8;margin-bottom:4px}
.card-title{font-size:17px;font-weight:800;color:#0f172a;margin-bottom:14px}

/* ── Controls ── */
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
.btn{padding:10px 20px;border-radius:8px;border:none;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s}
.btn-play{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff;box-shadow:0 4px 14px rgba(14,165,233,0.3)}
.btn-play:hover{box-shadow:0 6px 24px rgba(0,212,255,0.4);transform:translateY(-1px)}
.btn-reset{background:#f8fafc;color:#64748b;border:1px solid var(--border)}
.btn-reset:hover{background:#f1f5f9;color:#0f172a}
.speed-wrap{display:flex;align-items:center;gap:8px;margin-left:auto}
.speed-label{font-size:10px;color:#94a3b8;letter-spacing:1px;text-transform:uppercase}
input[type=range]{width:80px;accent-color:var(--cyan2);cursor:pointer}

/* ═══ TREE ═══ */
.tree-wrap{position:relative;overflow:hidden;margin-bottom:16px}
.tree-svg{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
.tree-levels{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;gap:20px;padding:8px 0}
.tree-row{display:flex;justify-content:center;gap:6px;position:relative}
.tree-row-tag{position:absolute;left:-44px;top:50%;transform:translateY(-50%);font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#94a3b8;white-space:nowrap}

/* Nodes */
.nd{
  width:56px;height:48px;border-radius:8px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  text-align:center;position:relative;cursor:default;
  background:#f8fafc;border:1.5px dashed #e2e8f0;color:#94a3b8;
  transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
  overflow:visible;
}
.nd .nm{font-size:10px;font-weight:800;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:50px}
.nd .sc{font-size:8px;font-weight:600;color:#94a3b8;margin-top:1px}
.nd .badge{position:absolute;top:-6px;right:-6px;width:15px;height:15px;border-radius:50%;font-size:7px;font-weight:800;display:none;align-items:center;justify-content:center;z-index:3;line-height:1}

/* YOU */
.nd.root{
  background:linear-gradient(135deg,#0ea5e9,#0284c7);border:2px solid var(--cyan);color:#fff;
  width:66px;height:56px;border-style:solid;
  box-shadow:0 4px 20px rgba(14,165,233,0.35);
}
.nd.root .nm{font-size:13px;color:#fff}
.nd.root .sc{color:rgba(255,255,255,0.7)}

/* States */
.nd.active{background:#f0f9ff;border:1.5px solid rgba(14,165,233,0.3);border-style:solid;color:#0f172a}
.nd.active .nm{color:#0f172a}
.nd.selling{border-color:#10b981!important;border-style:solid!important;background:rgba(16,185,129,0.08)!important;box-shadow:0 0 12px rgba(16,185,129,0.2)!important}
.nd.keeping{border-color:#10b981!important;border-style:solid!important;background:rgba(16,185,129,0.12)!important;box-shadow:0 0 16px rgba(16,185,129,0.3)!important;color:#065f46!important;animation:ndPulse 0.5s ease}
.nd.receiving{border-color:var(--gold)!important;border-style:solid!important;background:rgba(245,158,11,0.1)!important;box-shadow:0 0 18px rgba(245,158,11,0.3)!important;color:#92400e!important;animation:ndPulse 0.5s ease}
@keyframes ndPulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}

.nd.keeping .nm{color:#065f46!important}
.nd.receiving .nm{color:#92400e!important}

/* Float */
.cfloat{position:absolute;font-size:12px;font-weight:800;pointer-events:none;z-index:10;white-space:nowrap;left:50%;animation:fUp 1s ease-out forwards}
@keyframes fUp{0%{opacity:1;top:-6px;transform:translateX(-50%)}100%{opacity:0;top:-32px;transform:translateX(-50%)}}

/* Legend */
.legend{display:flex;gap:14px;flex-wrap:wrap;margin-bottom:16px}
.legend-i{display:flex;align-items:center;gap:6px;font-size:11px;color:#64748b}
.legend-s{width:12px;height:12px;border-radius:3px;flex-shrink:0}

/* How-strip */
.how-strip{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
@media(max-width:700px){.how-strip{grid-template-columns:repeat(2,1fr)}}
.how-s{background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.how-s .hnum{width:24px;height:24px;border-radius:6px;display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;margin-bottom:5px}
.how-s .ht{font-size:12px;font-weight:700;color:#0f172a;margin-bottom:2px}
.how-s .hd{font-size:10px;color:#64748b;line-height:1.45}

/* ── RIGHT COL ── */
.right-col{display:flex;flex-direction:column;gap:14px}
.eyebrow{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#38bdf8;margin-bottom:12px}
.earn-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f1f5f9}
.earn-row:last-child{border-bottom:none}
.earn-left{display:flex;align-items:center;gap:10px}
.earn-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.earn-label{font-size:13px;font-weight:600;color:#334155}
.earn-sub{font-size:11px;color:#94a3b8;margin-top:1px}
.earn-amount{font-size:18px;font-weight:700;text-align:right}
.earn-amount.bump{animation:numBump 0.25s ease}
@keyframes numBump{0%,100%{transform:scale(1)}50%{transform:scale(1.18)}}

.total-card{background:linear-gradient(135deg,#0284c7,#0ea5e9,#38bdf8);border:none;border-radius:14px;padding:20px;text-align:center;color:#fff}
.total-label{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.6);margin-bottom:4px}
.total-amount{font-size:32px;font-weight:800;color:#fff}
.total-sub{font-size:12px;color:rgba(255,255,255,0.55);margin-top:4px}

/* Split */
.split-bar{display:flex;height:8px;border-radius:99px;overflow:hidden;gap:2px;margin:10px 0 12px}
.split-seg{border-radius:3px}
.split-legend{display:flex;flex-direction:column;gap:6px}
.split-i{display:flex;align-items:center;gap:8px;font-size:12px;color:#64748b}
.split-sw{width:8px;height:8px;border-radius:2px;flex-shrink:0}
.split-v{margin-left:auto;font-weight:700}

/* Info */
.info-title{font-size:13px;font-weight:700;color:#0f172a;margin-bottom:10px}
.info-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #f1f5f9;font-size:12px}
.info-row:last-child{border-bottom:none}
.info-k{color:#64748b}.info-v{font-weight:700}

/* Log */
.log-list{display:flex;flex-direction:column;max-height:220px;overflow-y:auto}
.log-item{display:flex;align-items:center;font-size:11px;color:#64748b;padding:4px 0;border-bottom:1px solid #f8fafc;animation:slideIn 0.2s ease}
.log-item:last-child{border-bottom:none}
@keyframes slideIn{from{opacity:0;transform:translateX(-4px)}to{opacity:1;transform:none}}
.log-left{display:flex;align-items:center;gap:6px;min-width:0}
.log-who{font-weight:700;color:#334155;min-width:36px}
.log-sale{color:#94a3b8;font-size:10px}
.log-tag{font-size:8px;padding:2px 5px;border-radius:3px;font-weight:700;letter-spacing:0.5px;white-space:nowrap}
.log-tag.kept{color:#10b981;border:1px solid rgba(16,185,129,0.25);background:rgba(16,185,129,0.06)}
.log-tag.passup{color:var(--gold);border:1px solid rgba(245,158,11,0.25);background:rgba(245,158,11,0.06)}
.log-amt{font-weight:700;font-size:11px;white-space:nowrap;margin-left:auto;font-variant-numeric:tabular-nums}

/* Mobile nav */
.mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:rgba(2,8,24,0.97);border-top:1px solid rgba(14,165,233,0.12);z-index:200;backdrop-filter:blur(12px);padding:6px 0 max(6px,env(safe-area-inset-bottom))}
.mobile-nav-inner{display:flex;justify-content:space-around;max-width:480px;margin:0 auto}
.mob-nav-item{display:flex;flex-direction:column;align-items:center;gap:2px;text-decoration:none;padding:4px 8px;font-size:10px;color:#64748b;transition:color 0.15s}
.mob-nav-item.active{color:#38bdf8}
@media(max-width:768px){.mobile-nav{display:block}body{padding-bottom:72px}.topbar .topbar-brand-text{font-size:15px}.main{padding:0 12px 80px}}
</style>
</head>
<body>

<!-- ── Top Bar ── -->
<div class="topbar">
  <a href="/dashboard" class="topbar-back">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
    Dashboard
  </a>
  <a href="/" class="topbar-brand">
    <svg width="32" height="32" viewBox="0 0 44 44"><circle cx="22" cy="22" r="20" fill="url(#sap-g)"/><path d="M18 13l14 9-14 9V13z" fill="#fff"/><defs><linearGradient id="sap-g" x1="0" y1="0" x2="44" y2="44" gradientUnits="userSpaceOnUse"><stop stop-color="#0ea5e9"/><stop offset="1" stop-color="#38bdf8"/></linearGradient></defs></svg>
    <span class="topbar-brand-text">Super<em>Ad</em>Pro</span>
  </a>
</div>

<!-- ── Hero ── -->
<div class="hero">
  <div class="hero-badge">Stream 03 — Course Commissions</div>
  <h1>Infinite Pass-Up <span>Visualiser</span></h1>
  <p>Watch 100% course commissions cascade through your team. Your <strong style="color:#fff">2nd, 4th &amp; 6th</strong> sales pass up — everything else you keep forever.</p>
</div>

<!-- ── Tier Bar ── -->
<div class="tier-bar">
  <button class="tier-btn active" data-price="100" onclick="selectTier(this)">$100 Starter</button>
  <button class="tier-btn" data-price="300" onclick="selectTier(this)">$300 Advanced</button>
  <button class="tier-btn" data-price="500" onclick="selectTier(this)">$500 Elite</button>
</div>

<div class="main">
  <!-- ═══ LEFT ═══ -->
  <div class="card">
    <div class="card-eyebrow">Stream 03 — Course Pass-Up</div>
    <div class="card-title" id="panelTitle">INFINITE PASS-UP — $100 STARTER</div>

    <div class="controls">
      <button class="btn btn-play" id="playBtn" onclick="togglePlay()">▶ PLAY</button>
      <button class="btn btn-reset" onclick="resetSim()">↺ RESET</button>
      <div class="speed-wrap"><span class="speed-label">Speed</span><input type="range" min="1" max="5" value="3" id="speedSlider"></div>
    </div>

    <!-- TREE -->
    <div class="tree-wrap" id="treeWrap">
      <svg class="tree-svg" id="treeSvg"></svg>
      <div class="tree-levels" id="treeLvls"></div>
    </div>

    <div class="legend">
      <div class="legend-i"><div class="legend-s" style="background:linear-gradient(135deg,#0ea5e9,#0284c7);border:1.5px solid var(--cyan)"></div>You (Root)</div>
      <div class="legend-i"><div class="legend-s" style="background:#f0f9ff;border:1.5px solid rgba(14,165,233,0.3)"></div>Active Member</div>
      <div class="legend-i"><div class="legend-s" style="background:rgba(16,185,129,0.12);border:1.5px solid var(--green)"></div>Keeps Sale</div>
      <div class="legend-i"><div class="legend-s" style="background:rgba(245,158,11,0.1);border:1.5px solid var(--gold)"></div>Pass-Up</div>
    </div>

    <div class="how-strip">
      <div class="how-s"><div class="hnum" style="background:rgba(14,165,233,0.1);color:var(--cyan2)">1</div><div class="ht">Refer &amp; Sell</div><div class="hd">Refer someone who buys a course — that's your sale</div></div>
      <div class="how-s"><div class="hnum" style="background:rgba(16,185,129,0.1);color:var(--green)">2</div><div class="ht">Keep 100%</div><div class="hd">Sales 1, 3, 5, 7+ you keep the full commission</div></div>
      <div class="how-s"><div class="hnum" style="background:rgba(245,158,11,0.1);color:var(--gold)">3</div><div class="ht">Pass Up 3</div><div class="hd">Your 2nd, 4th &amp; 6th sales pass up to your sponsor</div></div>
      <div class="how-s"><div class="hnum" style="background:rgba(124,58,237,0.1);color:#8b5cf6">4</div><div class="ht">Infinite Depth</div><div class="hd">Pass-ups cascade through every level of your team</div></div>
    </div>
  </div>

  <!-- ═══ RIGHT ═══ -->
  <div class="right-col">
    <div class="card">
      <div class="eyebrow">Live Earnings Tracker</div>
      <div class="earn-row">
        <div class="earn-left"><div class="earn-dot" style="background:var(--green)"></div><div><div class="earn-label">Direct Sales Kept</div><div class="earn-sub">Your sales 1, 3, 5, 7+</div></div></div>
        <div class="earn-amount" id="keptAmt" style="color:#10b981">$0</div>
      </div>
      <div class="earn-row">
        <div class="earn-left"><div class="earn-dot" style="background:var(--gold)"></div><div><div class="earn-label">Pass-Ups Received</div><div class="earn-sub">Team's 2nd, 4th, 6th</div></div></div>
        <div class="earn-amount" id="passupAmt" style="color:var(--gold)">$0</div>
      </div>
    </div>

    <div class="total-card">
      <div class="total-label">Your Total Course Earnings</div>
      <div class="total-amount" id="totalAmt">$0</div>
      <div class="total-sub"><span id="keptCount">0</span> kept · <span id="passupCount">0</span> pass-ups</div>
    </div>

    <div class="card">
      <div class="eyebrow">Per Sale Commission — $<span id="splitPrice">100</span></div>
      <div class="split-bar"><div class="split-seg" style="flex:4;background:var(--green)"></div><div class="split-seg" style="flex:3;background:var(--gold)"></div></div>
      <div class="split-legend">
        <div class="split-i"><div class="split-sw" style="background:var(--green)"></div>You keep (1,3,5,7+)<span class="split-v" id="spKeep" style="color:#10b981">$100</span></div>
        <div class="split-i"><div class="split-sw" style="background:var(--gold)"></div>Passes up (2,4,6)<span class="split-v" id="spPass" style="color:var(--gold)">$100</span></div>
      </div>
    </div>

    <div class="card">
      <div class="info-title">Simulation Stats</div>
      <div class="info-row"><span class="info-k">Course tier</span><span class="info-v" id="infoTier" style="color:var(--cyan2)">$100 Starter</span></div>
      <div class="info-row"><span class="info-k">Total team sales</span><span class="info-v" id="infoTotal" style="color:var(--cyan2)">0</span></div>
      <div class="info-row"><span class="info-k">Your personal sales</span><span class="info-v" id="infoDirect" style="color:var(--green)">0</span></div>
      <div class="info-row"><span class="info-k">Pass-ups received</span><span class="info-v" id="infoPassups" style="color:var(--gold)">0</span></div>
      <div class="info-row"><span class="info-k">Depth reached</span><span class="info-v" id="infoDepth">0 levels</span></div>
    </div>

    <div class="card">
      <div class="eyebrow" style="font-size:10px;margin-bottom:8px">Activity Log</div>
      <div class="log-list" id="logList">
        <div class="log-item"><span style="color:#94a3b8;font-size:11px">Press PLAY to start…</span></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ═══ PASS-UP ENGINE ═══════════════════════════════════════════ */
let tier=100;
const PU=new Set([2,4,6]);
const NM=['Alex','Beth','Carl','Dana','Eric','Faye','Gina','Hugo','Iris','Jake','Kate','Leo','Mia','Nate','Olga','Paul','Quinn','Rosa','Sam','Tina','Uma','Vera','Will','Xena','Yuri','Zara','Abe','Bea','Cody','Dex','Eva','Finn','Grace','Hank','Ivy','Joel','Kim','Meg','Nico','Opal','Pete','Rae','Seth','Tara','Val','Wade','Flora','Glen','Hope','Ian'];
let nodes=[],nMap={},playing=false,tmr=null,queue=[],qi=0;
let tK=0,tP=0,nK=0,nP=0,tS=0,mD=0;

function buildTree(){
  nodes=[];nMap={};let id=0,ni=0;
  function mk(nm,lv,pid){const n={id:id++,nm,lv,pid,pu:null,sc:0,rc:0,ch:[],el:null};nodes.push(n);nMap[n.id]=n;return n;}
  const r=mk('YOU',0,null);
  for(let i=0;i<6;i++){const c=mk(NM[ni++],1,0);r.ch.push(c.id);r.rc++;c.pu=PU.has(r.rc)?(r.pu??r.id):r.id;}
  for(const cid of r.ch){const p=nMap[cid];for(let i=0;i<3;i++){const c=mk(NM[ni++],2,p.id);p.ch.push(c.id);p.rc++;c.pu=PU.has(p.rc)?(p.pu??p.id):p.id;}}
  nodes.filter(n=>n.lv===2).forEach(p=>{for(let i=0;i<2;i++){const c=mk(NM[ni++%NM.length],3,p.id);p.ch.push(c.id);p.rc++;c.pu=PU.has(p.rc)?(p.pu??p.id):p.id;}});
}

function buildQueue(){
  queue=[];
  for(let r=1;r<=7;r++){
    const b=nodes.filter(n=>n.id>0).map(n=>({sid:n.pid,r}));
    for(let i=b.length-1;i>0;i--){const j=Math.random()*i|0;[b[i],b[j]]=[b[j],b[i]];}
    queue.push(...b);
  }
}

function renderTree(){
  const wrap=document.getElementById('treeLvls');wrap.innerHTML='';
  const lvls=[[],[],[],[]];
  nodes.forEach(n=>lvls[n.lv].push(n));
  const tags=['YOU','LEVEL 1','LEVEL 2','LEVEL 3'];
  lvls.forEach((lv,li)=>{
    const row=document.createElement('div');row.className='tree-row';
    lv.forEach(n=>{
      const el=document.createElement('div');
      el.className='nd'+(li===0?' root':'');
      el.id='n'+n.id;
      el.innerHTML=`<div class="nm">${n.nm}</div><div class="sc" id="sc${n.id}">0 sales</div><div class="badge" id="pb${n.id}"></div>`;
      row.appendChild(el);n.el=el;
    });
    wrap.appendChild(row);
  });
  requestAnimationFrame(()=>requestAnimationFrame(drawLines));
}

function drawLines(){
  const svg=document.getElementById('treeSvg');
  const w=document.getElementById('treeWrap');
  const cr=w.getBoundingClientRect();
  svg.setAttribute('width',w.scrollWidth);
  svg.setAttribute('height',w.scrollHeight);
  svg.innerHTML='';
  nodes.forEach(n=>{
    if(n.pid===null||!n.el)return;
    const p=nMap[n.pid];if(!p||!p.el)return;
    const pr=p.el.getBoundingClientRect(),nr=n.el.getBoundingClientRect();
    const x1=pr.left+pr.width/2-cr.left,y1=pr.top+pr.height-cr.top;
    const x2=nr.left+nr.width/2-cr.left,y2=nr.top-cr.top;
    // Curved path
    const my=(y1+y2)/2;
    const path=document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d',`M${x1},${y1} C${x1},${my} ${x2},${my} ${x2},${y2}`);
    path.setAttribute('fill','none');
    path.setAttribute('stroke','#cbd5e1');
    path.setAttribute('stroke-width','1.5');
    path.id=`ln${n.pid}-${n.id}`;
    svg.appendChild(path);
  });
}

function processSale(){
  if(qi>=queue.length){pause();addLog('✅','','Complete','#38bdf8','kept');return;}
  const s=queue[qi++];const sl=nMap[s.sid];if(!sl){processSale();return;}
  sl.sc++;tS++;const sn=sl.sc;const isUp=PU.has(sn);
  const sce=document.getElementById('sc'+sl.id);if(sce)sce.textContent=sn+(sn===1?' sale':' sales');
  if(sl.el&&!sl.el.classList.contains('root'))sl.el.classList.add('active');
  if(sl.lv>mD)mD=sl.lv;

  if(isUp){
    let rid=sl.pu,rec=rid!=null?nMap[rid]:null;if(!rec)rec=nMap[0];
    sl.el.classList.add('selling');setTimeout(()=>sl.el.classList.remove('selling'),600);
    const bd=document.getElementById('pb'+sl.id);
    if(bd){bd.style.display='flex';bd.style.background='var(--gold)';bd.style.color='#fff';bd.textContent='↑';}
    const ln=document.getElementById(`ln${sl.pid}-${sl.id}`);
    if(ln){ln.setAttribute('stroke','#f59e0b');ln.setAttribute('stroke-width','2.5');ln.setAttribute('stroke-dasharray','5 3');}
    rec.el.classList.add('receiving');setTimeout(()=>rec.el.classList.remove('receiving'),700);
    showFloat(rec.el,'+$'+tier,'#f59e0b');
    if(rec.id===0){tP+=tier;nP++;}
    addLog(sl.nm,'#'+sn,'↑ '+rec.nm,'#f59e0b','passup');
  } else {
    sl.el.classList.add('keeping');setTimeout(()=>sl.el.classList.remove('keeping'),500);
    showFloat(sl.el,'+$'+tier,'#10b981');
    const bd=document.getElementById('pb'+sl.id);
    if(bd&&sn<=6){bd.style.display='flex';bd.style.background='var(--green)';bd.style.color='#fff';bd.textContent='✓';}
    if(sl.id===0){tK+=tier;nK++;}
    addLog(sl.nm,'#'+sn,'KEPT ✓','#10b981','kept');
  }
  updateUI();
}

function showFloat(el,t,c){const f=document.createElement('div');f.className='cfloat';f.textContent=t;f.style.color=c;el.appendChild(f);setTimeout(()=>f.remove(),1000);}
function updateUI(){
  bump('keptAmt','$'+tK.toLocaleString());bump('passupAmt','$'+tP.toLocaleString());
  document.getElementById('totalAmt').textContent='$'+(tK+tP).toLocaleString();
  document.getElementById('keptCount').textContent=nK;document.getElementById('passupCount').textContent=nP;
  document.getElementById('infoTotal').textContent=tS;document.getElementById('infoDirect').textContent=nMap[0].sc;
  document.getElementById('infoPassups').textContent=nP;document.getElementById('infoDepth').textContent=mD+' levels';
}
function bump(id,v){const e=document.getElementById(id);e.textContent=v;e.classList.remove('bump');void e.offsetWidth;e.classList.add('bump');}
function addLog(who,sale,act,col,type){
  const l=document.getElementById('logList');
  if(l.querySelector('[style*="94a3b8"]'))l.innerHTML='';
  const it=document.createElement('div');it.className='log-item';
  it.innerHTML=`<div class="log-left"><span class="log-who">${who}</span><span class="log-sale">${sale}</span><span class="log-tag ${type}">${act}</span></div><span class="log-amt" style="color:${col}">$${tier}</span>`;
  l.insertBefore(it,l.firstChild);while(l.children.length>12)l.removeChild(l.lastChild);
}

function togglePlay(){playing?pause():play();}
function play(){playing=true;document.getElementById('playBtn').textContent='⏸ PAUSE';tick();}
function pause(){playing=false;clearTimeout(tmr);document.getElementById('playBtn').textContent='▶ PLAY';}
function getDelay(){return Math.round(800-(parseInt(document.getElementById('speedSlider').value)-1)*160);}
function tick(){if(!playing)return;processSale();if(qi<queue.length)tmr=setTimeout(tick,getDelay());else pause();}

function selectTier(btn){
  document.querySelectorAll('.tier-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');
  tier=parseInt(btn.dataset.price);const lb=tier===100?'STARTER':tier===300?'ADVANCED':'ELITE';
  document.getElementById('panelTitle').textContent='INFINITE PASS-UP — $'+tier+' '+lb;
  document.getElementById('infoTier').textContent='$'+tier+' '+lb.charAt(0)+lb.slice(1).toLowerCase();
  document.getElementById('splitPrice').textContent=tier;document.getElementById('spKeep').textContent='$'+tier;document.getElementById('spPass').textContent='$'+tier;
  resetSim();
}
function resetSim(){
  pause();tK=0;tP=0;nK=0;nP=0;tS=0;mD=0;qi=0;
  buildTree();buildQueue();renderTree();updateUI();
  document.getElementById('logList').innerHTML='<div class="log-item"><span style="color:#94a3b8;font-size:11px">Press PLAY to start…</span></div>';
  document.getElementById('playBtn').textContent='▶ PLAY';
}
resetSim();
window.addEventListener('resize',()=>requestAnimationFrame(drawLines));
</script>

<div class="mobile-nav">
  <div class="mobile-nav-inner">
    <a href="/dashboard" class="mob-nav-item"><span>⊞</span>Home</a>
    <a href="/watch" class="mob-nav-item"><span>▶</span>Watch</a>
    <a href="/income-grid" class="mob-nav-item"><span>⚡</span>Grid</a>
    <a href="/wallet" class="mob-nav-item"><span>◎</span>Wallet</a>
    <a href="/passup-visualiser" class="mob-nav-item active"><span>↑</span>Pass-Up</a>
  </div>
</div>
</body>
</html>
