<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Grid Visualiser — SuperAdPro</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@700;800&family=DM+Sans:wght@400;500;600;700;800&family=Rethink+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>

:root{--cyan:#38bdf8;--cyan2:#0ea5e9;--green:#10b981;--gold:#f59e0b;--bg:#f0f2f8;--border:#e2e8f0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans','Rethink Sans',sans-serif;background:var(--bg);color:#0f172a;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0}
@keyframes gridDrift{from{background-position:0 0}to{background-position:48px 48px}}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0}

nav{background:#0a0a1a;border-bottom:1px solid rgba(14,165,233,0.12);padding:0 40px;height:70px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.nav-brand{display:flex;align-items:center;gap:10px;text-decoration:none}
.nav-brand span{font-weight:800;font-size:19px;letter-spacing:2px;text-transform:uppercase;background:linear-gradient(135deg,#0ea5e9,#38bdf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-links{display:flex;align-items:center;gap:24px}
.nav-links a{font-size:19px;font-weight:500;color:#4a5a6e;text-decoration:none;transition:color 0.2s}
.nav-links a:hover{color:var(--cyan)}
.btn-nav{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff!important;padding:8px 20px;border-radius:7px;font-weight:700!important}

.hero{text-align:center;padding:40px 40px 28px;position:relative;z-index:1;background:linear-gradient(135deg,#0284c7 0%,#0ea5e9 40%,#38bdf8 100%);border-radius:0 0 24px 24px;margin-bottom:20px}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);border-radius:999px;padding:6px 18px;font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;margin-bottom:20px}
.hero-badge::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--cyan);animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
.hero h1{font-size:clamp(22px,4vw,40px);font-weight:800;line-height:1.1;margin-bottom:10px;color:#fff;font-family:Sora,sans-serif}
.hero h1 span{color:#e0f2fe;-webkit-text-fill-color:#e0f2fe}
.hero p{font-size:15px;color:rgba(255,255,255,0.7);max-width:560px;margin:0 auto;line-height:1.7}

.pkg-bar{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;padding:16px 40px 20px;position:relative;z-index:1;background:#fff;border:1px solid #e2e8f0;border-radius:14px;max-width:1200px;margin:0 auto 20px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.pkg-btn{padding:8px 16px;border-radius:10px;border:none;background:transparent;color:#64748b;font-family:'DM Sans','Rethink Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s}
.pkg-btn:hover{color:#0ea5e9;background:rgba(14,165,233,0.05)}
.pkg-btn.active{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff;box-shadow:0 4px 14px rgba(14,165,233,0.3)}

.main{display:grid;grid-template-columns:1fr 340px;gap:20px;max-width:1200px;margin:0 auto;padding:0 24px 80px;position:relative;z-index:1}
@media(max-width:900px){.main{grid-template-columns:1fr}}

.grid-panel{background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:24px;box-shadow:0 1px 4px rgba(0,40,100,0.04)}
.panel-eyebrow{font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:#38bdf8;margin-bottom:4px}
.panel-title{font-size:18px;font-weight:800;color:#0f172a;margin-bottom:16px}

.level-labels{display:grid;grid-template-columns:repeat(8,1fr);gap:5px;margin-bottom:4px}
.level-label{text-align:center;font-size:19px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:2px 0}

/* GRID */
.grid-wrap{display:grid;grid-template-columns:repeat(8,1fr);gap:5px;margin-bottom:16px}
.cell{
  aspect-ratio:1;min-height:64px;border-radius:6px;
  display:flex;align-items:center;justify-content:center;
  font-size:clamp(10px,1.3vw,15px);font-weight:800;line-height:1.2;text-align:center;
  transition:all 0.35s cubic-bezier(0.34,1.56,0.64,1);
  background:#f8fafc;border:1px dashed #e2e8f0;
  color:transparent;cursor:default;position:relative;overflow:hidden;
  -webkit-font-smoothing:antialiased;will-change:transform;
}
.cell::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent);opacity:0;transition:opacity 0.3s}
/* Owner cell */
.cell.owner{background:linear-gradient(135deg,#0ea5e9,#0e7490)!important;border:2px solid var(--cyan)!important;color:#fff!important;box-shadow:0 0 24px rgba(0,212,255,0.5),0 0 48px rgba(56,189,248,0.15)!important}
.cell.owner::before{opacity:1}
/* Direct referral — bright green glow */
.cell.direct{color:#fff!important;border:2px solid rgba(52,211,153,0.7)!important;box-shadow:0 0 18px rgba(16,185,129,0.55),0 0 36px rgba(16,185,129,0.2)!important}
/* Overspill — level colour, subtler */
.cell.overspill{color:rgba(255,255,255,0.9)!important}
.cell.pop{animation:cellPop 0.45s cubic-bezier(0.34,1.56,0.64,1)}
@keyframes cellPop{0%{transform:scale(0.25);opacity:0}65%{transform:scale(1.12)}100%{transform:scale(1)}}

/* Controls */
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
.btn{padding:10px 20px;border-radius:8px;border:none;font-family:'DM Sans','Rethink Sans',sans-serif;font-size:19px;font-weight:700;cursor:pointer;transition:all 0.2s}
.btn-play{background:linear-gradient(135deg,#0ea5e9,#38bdf8);color:#fff;box-shadow:0 4px 14px rgba(14,165,233,0.3)}
.btn-play:hover{box-shadow:0 6px 24px rgba(0,212,255,0.4);transform:translateY(-1px)}
.btn-reset{background:#f8fafc;color:#64748b;border:1px solid #e2e8f0}
.btn-reset:hover{background:#f1f5f9;color:#0f172a}
.speed-wrap{display:flex;align-items:center;gap:8px;margin-left:auto}
.speed-label{font-size:11px;color:#94a3b8;letter-spacing:1px;text-transform:uppercase}
input[type=range]{width:80px;accent-color:var(--cyan);cursor:pointer}

/* Direct-count slider panel */
.direct-panel{background:rgba(16,185,129,0.04);border:1px solid rgba(16,185,129,0.12);border-radius:10px;padding:14px 16px;margin-bottom:14px}
.direct-panel-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.direct-panel-label{font-size:14px;font-weight:700;color:#0f172a}
.direct-panel-sub{font-size:12px;color:#94a3b8;margin-top:2px}
.direct-count-big{font-size:32px;font-weight:800;color:var(--green);line-height:1}
.direct-count-caption{font-size:19px;color:#94a3b8}
.legend-row{display:flex;gap:14px;margin-top:10px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:6px;font-size:19px;color:#64748b}
.legend-swatch{width:14px;height:14px;border-radius:3px;flex-shrink:0}

/* Progress */
.progress-wrap{margin-bottom:14px}
.progress-row{display:flex;justify-content:space-between;margin-bottom:6px}
.progress-label{font-size:10px;color:#94a3b8;letter-spacing:1px;text-transform:uppercase}
.progress-value{font-size:19px;color:var(--cyan)}
.progress-bar{height:3px;background:rgba(255,255,255,0.06);border-radius:99px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--cyan),#38bdf8);border-radius:99px;transition:width 0.3s;box-shadow:0 0 8px rgba(0,212,255,0.4)}

/* Advance note */
.advance-note{display:flex;align-items:flex-start;gap:12px;padding:12px 14px;background:rgba(14,165,233,0.05);border:1px solid rgba(14,165,233,0.12);border-radius:8px;margin-bottom:12px}
.advance-note-text{font-size:19px;color:#64748b;line-height:1.6}
.advance-note-title{font-size:19px;font-weight:700;color:#38bdf8;margin-bottom:3px}

/* Advance banner */
.advance-banner{display:none;text-align:center;padding:16px;background:rgba(14,165,233,0.06);border:1px solid rgba(14,165,233,0.15);border-radius:10px}
.advance-banner.show{display:block;animation:fadeUp 0.4s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.advance-title{font-size:19px;font-weight:700;color:var(--cyan);margin-bottom:4px}
.advance-sub{font-size:19px;color:#64748b}

/* RIGHT col */
.right-col{display:flex;flex-direction:column;gap:14px}
.stat-card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:18px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.eyebrow{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#38bdf8;margin-bottom:12px}
.earn-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.earn-row:last-child{border-bottom:none;padding-bottom:0}
.earn-left{display:flex;align-items:center;gap:10px}
.earn-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.earn-label{font-size:13px;color:#64748b}
.earn-sub{font-size:11px;color:#94a3b8;margin-top:2px}
.earn-amount{font-size:19px;font-weight:700;transition:all 0.25s;text-align:right}
.earn-amount.bump{animation:numBump 0.25s ease}
@keyframes numBump{0%,100%{transform:scale(1)}50%{transform:scale(1.18)}}

.total-card{background:linear-gradient(135deg,#0284c7,#0ea5e9,#38bdf8);border:none;border-radius:14px;padding:18px;text-align:center}
.total-label{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.6);margin-bottom:6px}
.total-amount{font-size:30px;font-weight:800;color:#fff;-webkit-text-fill-color:#fff;transition:all 0.3s}
.total-sub{font-size:12px;color:rgba(255,255,255,0.55);margin-top:4px}

.split-card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:18px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.split-bar-wrap{display:flex;height:8px;border-radius:99px;overflow:hidden;gap:2px;margin:10px 0 12px}
.split-seg{border-radius:3px}
.split-legend{display:flex;flex-direction:column;gap:7px}
.split-item{display:flex;align-items:center;gap:8px;font-size:13px;color:#64748b}
.split-swatch{width:8px;height:8px;border-radius:2px;flex-shrink:0}
.split-pct{margin-left:auto;font-size:19px;font-weight:700}

.info-strip{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:18px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.info-title{font-size:14px;font-weight:700;color:#0f172a;margin-bottom:10px}
.info-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:19px}
.info-row:last-child{border-bottom:none}
.info-key{color:#64748b}
.info-val{font-weight:700}

.log-card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.log-list{display:flex;flex-direction:column;gap:0;max-height:none;overflow:hidden}
.log-item{display:flex;align-items:center;font-size:12px;color:#64748b;animation:slideIn 0.22s ease;padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.log-item:last-child{border-bottom:none}
@keyframes slideIn{from{opacity:0;transform:translateX(-6px)}to{opacity:1;transform:none}}
.log-left{display:flex;align-items:center;gap:6px;min-width:0}
.log-seat{font-weight:700;color:rgba(255,255,255,0.55);font-variant-numeric:tabular-nums;min-width:52px}
.log-level{color:#94a3b8;min-width:22px}
.log-tag{font-size:9px;padding:2px 6px;border-radius:3px;font-weight:700;letter-spacing:0.5px;white-space:nowrap}
.log-tag.direct{color:#10b981;border:1px solid rgba(16,185,129,0.35);background:rgba(16,185,129,0.08)}
.log-tag.overspill{color:rgba(0,180,216,0.6);border:1px solid rgba(56,189,248,0.15);background:rgba(0,212,255,0.04)}
.log-amt{font-weight:700;font-size:12px;white-space:nowrap;margin-left:auto;font-variant-numeric:tabular-nums}
.reg-overlay{position:fixed;inset:0;background:rgba(1,8,20,0.85);backdrop-filter:blur(6px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px;opacity:0;pointer-events:none;transition:opacity 0.25s}
.reg-overlay.open{opacity:1;pointer-events:all}
.reg-modal{background:#0d1117;border:1px solid rgba(56,189,248,0.15);border-radius:18px;padding:36px 38px;width:100%;max-width:460px;position:relative;box-shadow:0 24px 80px rgba(0,0,0,0.6);transform:translateY(20px);transition:transform 0.25s}
.reg-overlay.open .reg-modal{transform:translateY(0)}
.reg-close{position:absolute;top:14px;right:18px;background:none;border:none;color:rgba(200,220,255,0.4);font-size:22px;cursor:pointer;line-height:1;padding:4px 8px;border-radius:6px;transition:color 0.2s}
.reg-close:hover{color:rgba(200,220,255,0.9)}
.reg-title{font-size:22px;font-weight:800;color:#fff;margin-bottom:4px}
.reg-sub{font-size:16px;color:rgba(200,220,255,0.5);margin-bottom:24px}
.reg-field{margin-bottom:16px}
.reg-label{display:block;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(200,220,255,0.5);margin-bottom:6px}
.reg-input{width:100%;padding:11px 14px;border:1.5px solid rgba(0,212,255,0.12);border-radius:9px;background:rgba(0,212,255,0.04);color:#fff;font-size:16px;font-family:inherit;box-sizing:border-box;transition:border-color 0.2s}
.reg-input:focus{outline:none;border-color:#38bdf8;background:rgba(56,189,248,0.07)}
.reg-input::placeholder{color:rgba(200,220,255,0.25)}
.reg-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.reg-terms{display:flex;align-items:flex-start;gap:10px;margin-bottom:20px;font-size:16px;color:rgba(200,220,255,0.45);line-height:1.5}
.reg-terms input{width:15px;height:15px;flex-shrink:0;margin-top:1px;accent-color:#38bdf8}
.reg-terms a{color:rgba(0,212,255,0.7);text-decoration:none}
.reg-submit{width:100%;padding:13px;background:linear-gradient(135deg,#0ea5e9,#38bdf8);border:none;border-radius:10px;color:#fff;font-size:16px;font-weight:800;font-family:inherit;cursor:pointer;transition:opacity 0.2s;letter-spacing:0.3px}
.reg-submit:hover{opacity:0.9}
.reg-submit:disabled{opacity:0.5;cursor:not-allowed}
.reg-err{display:none;margin-bottom:14px;padding:10px 14px;background:#fef2f2;border:1px solid #fecaca;border-radius:8px;font-size:16px;color:#dc2626;font-weight:600}
.reg-login{text-align:center;margin-top:16px;font-size:16px;color:rgba(200,220,255,0.4)}
.reg-login a{color:rgba(0,212,255,0.7);text-decoration:none;font-weight:600}
@media(max-width:500px){.reg-modal{padding:28px 22px}.reg-row{grid-template-columns:1fr}}


.login-overlay{position:fixed;inset:0;background:rgba(1,8,20,0.85);backdrop-filter:blur(6px);z-index:1001;display:flex;align-items:center;justify-content:center;padding:16px;opacity:0;pointer-events:none;transition:opacity 0.25s}
.login-overlay.open{opacity:1;pointer-events:all}
.login-modal{background:#0d1117;border:1px solid rgba(56,189,248,0.15);border-radius:18px;padding:36px 38px;width:100%;max-width:400px;position:relative;box-shadow:0 24px 80px rgba(0,0,0,0.6);transform:translateY(20px);transition:transform 0.25s}
.login-overlay.open .login-modal{transform:translateY(0)}
@media(max-width:500px){.login-modal{padding:28px 22px}}



.int-topbar{display:flex;align-items:center;justify-content:space-between;padding:0 28px;height:64px;background:#111827;border-bottom:2px solid rgba(0,212,255,0.3);position:sticky;top:0;z-index:200;box-shadow:0 2px 12px rgba(0,0,0,0.5)}
.int-topbar-left{display:flex;align-items:center;gap:28px}
.int-topbar-title{font-size:18px;font-weight:800;color:#fff}
.int-topbar-sub{font-size:12px;color:rgba(200,220,255,0.5);margin-top:1px}
.int-back{display:flex;align-items:center;gap:6px;color:#94a3b8;text-decoration:none;font-size:14px;font-weight:600;padding:8px 16px;border:1px solid rgba(255,255,255,0.15);border-radius:8px;background:rgba(255,255,255,0.05);transition:all 0.2s}
.int-back:hover{border-color:rgba(56,189,248,0.4);color:#38bdf8;background:rgba(56,189,248,0.08)}
.int-topbar-user{display:flex;align-items:center;gap:10px;color:rgba(200,220,255,0.6);font-size:13px;font-weight:500}
.int-topbar-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#0ea5e9,#38bdf8);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#fff}

</style>
</head>
<body>
<div class="int-topbar">
  <div class="int-topbar-left">
    <a href="/dashboard" class="int-back"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 1L3 7l7 6"/></svg> Dashboard</a>
    <div><div class="int-topbar-title">◈ Grid Visualiser</div><div class="int-topbar-sub">See how the 8×8 Profit Engine Grid works</div></div>
  </div>
  <div class="int-topbar-user"><span>{{ user.username if user else '' }}</span><div class="int-topbar-avatar">{{ (user.username[0]|upper) if user else 'U' }}</div></div>
</div>


<!-- ── Login Modal ── -->
<div class="login-overlay" id="loginOverlay" onclick="if(event.target===this)closeLoginModal()">
  <div class="login-modal">
    <button class="reg-close" onclick="closeLoginModal()" aria-label="Close">✕</button>
    <div class="reg-title">Log In</div>
    <div class="reg-sub">Welcome back · Enter your details below</div>
    <div id="loginErr" class="reg-err"></div>
    <form id="loginModalForm">
      <div class="reg-field">
        <label class="reg-label">Username or Email</label>
        <input class="reg-input" type="text" id="loginUser" placeholder="username or email" required autocomplete="username">
      </div>
      <div class="reg-field" style="margin-bottom:8px">
        <label class="reg-label">Password</label>
        <input class="reg-input" type="password" id="loginPw" placeholder="Your password" required autocomplete="current-password">
      </div>
      <div style="text-align:right;margin-bottom:20px">
        <a href="/forgot-password" style="font-size:16px;color:rgba(0,212,255,0.6);text-decoration:none">Forgot password?</a>
      </div>
      <button type="submit" class="reg-submit" id="loginBtn">Log In →</button>
    </form>
    <div class="reg-login">Don’t have an account? <a href="#" onclick="closeLoginModal();openRegModal();return false;">Register here →</a></div>
  </div>
</div>

<!-- ── Registration Modal ── -->
<div class="reg-overlay" id="regOverlay" onclick="if(event.target===this)closeRegModal()">
  <div class="reg-modal">
    <button class="reg-close" onclick="closeRegModal()" aria-label="Close">✕</button>
    <div class="reg-title">Create Your Free Account</div>
    <div class="reg-sub">Takes 60 seconds · No credit card required</div>
    <div id="regErr" class="reg-err"></div>
    <form id="regModalForm">
      <input type="hidden" id="regRef" name="ref" value="">
      <div class="reg-field">
        <label class="reg-label">First Name</label>
        <input class="reg-input" type="text" id="regFirstName" placeholder="John" required autocomplete="given-name">
      </div>
      <div class="reg-field">
        <label class="reg-label">Email Address</label>
        <input class="reg-input" type="email" id="regEmail" placeholder="john@example.com" required autocomplete="email">
      </div>
      <div class="reg-field">
        <label class="reg-label">Username <span style="font-weight:400;letter-spacing:0;text-transform:none;color:rgba(200,220,255,0.3)">— becomes your referral ID</span></label>
        <input class="reg-input" type="text" id="regUsername" placeholder="johnsmith99" required autocomplete="off" pattern="[a-zA-Z0-9_]{3,30}">
      </div>
      <div class="reg-row">
        <div class="reg-field">
          <label class="reg-label">Password</label>
          <input class="reg-input" type="password" id="regPw" placeholder="Min. 8 chars" required minlength="8" autocomplete="new-password">
        </div>
        <div class="reg-field">
          <label class="reg-label">Confirm</label>
          <input class="reg-input" type="password" id="regPwC" placeholder="Repeat" required autocomplete="new-password">
        </div>
      </div>
      <div class="reg-field" id="regSponsorField" style="display:none">
        <label class="reg-label">Referred by</label>
        <input class="reg-input" type="text" id="regSponsor" placeholder="Sponsor username" autocomplete="off" readonly style="opacity:0.6">
      </div>
      <div class="reg-terms">
        <input type="checkbox" id="regTerms" required>
        <div>I agree to the <a href="/legal" target="_blank">Terms of Service</a> and <a href="/legal" target="_blank">Privacy Policy</a>.</div>
      </div>
      <button type="submit" class="reg-submit" id="regBtn">Register Here →</button>
    </form>
    <div class="reg-login">Already have an account? <a href="#" onclick="closeRegModal();openLoginModal();return false;">Log in here →</a></div>
  </div>
</div>


<div class="hero">
  <a href="/dashboard" style="display:inline-block;margin-bottom:16px;font-size:16px;font-weight:600;color:rgba(200,220,255,0.6);text-decoration:none;border:1px solid rgba(200,220,255,0.15);border-radius:7px;padding:7px 16px;transition:all 0.2s">← Back to Dashboard</a>
  <div class="hero-badge">Live Interactive Demo</div>
  <h1>Profit Engine Grid<br><span>Visualiser</span></h1>
  <p>Watch your grid fill with a realistic mix of your own <strong style="color:#10b981">direct referrals</strong> and <strong style="color:#38bdf8">upline overspill</strong> — scattered randomly across every level, just like the real thing.</p>
</div>

<div class="pkg-bar" id="pkgBar">
  <button class="pkg-btn" data-price="20"   onclick="selectPkg(this)">$20</button>
  <button class="pkg-btn" data-price="50"   onclick="selectPkg(this)">$50</button>
  <button class="pkg-btn active" data-price="100"  onclick="selectPkg(this)">$100</button>
  <button class="pkg-btn" data-price="200"  onclick="selectPkg(this)">$200</button>
  <button class="pkg-btn" data-price="400"  onclick="selectPkg(this)">$400</button>
  <button class="pkg-btn" data-price="600"  onclick="selectPkg(this)">$600</button>
  <button class="pkg-btn" data-price="800"  onclick="selectPkg(this)">$800</button>
  <button class="pkg-btn" data-price="1000" onclick="selectPkg(this)">$1,000</button>
</div>

<div class="main">

  <!-- LEFT -->
  <div class="grid-panel">
    <div class="panel-eyebrow">Stream 02 — Profit Engine Grid</div>
    <div class="panel-title" id="panelTitle">8×8 GRID — $100 PRO TIER</div>

    <div class="level-labels" id="levelLabels"></div>
    <div class="grid-wrap"   id="gridWrap"></div>

    <!-- Controls -->
    <div class="controls">
      <button class="btn btn-play"  id="playBtn" onclick="togglePlay()">▶ PLAY</button>
      <button class="btn btn-reset" onclick="resetGrid()">↺ RESET</button>
      <div class="speed-wrap">
        <span class="speed-label">Speed</span>
        <input type="range" min="1" max="5" value="3" id="speedSlider">
      </div>
    </div>

    <!-- Direct count slider -->
    <div class="direct-panel">
      <div class="direct-panel-top">
        <div>
          <div class="direct-panel-label">Your Personal Direct Referrals</div>
          <div class="direct-panel-sub">Randomly placed across all 8 levels — the rest is upline overspill</div>
        </div>
        <div style="text-align:right">
          <div class="direct-count-big" id="directCountDisplay">15</div>
          <div class="direct-count-caption">of 63 seats</div>
        </div>
      </div>
      <input type="range" min="0" max="63" value="15" id="directSlider"
             style="width:100%;accent-color:#10b981" oninput="updateDirectCount(this.value)">
      <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:19px;color:rgba(255,255,255,0.2)">
        <span>0 directs</span><span>~30 directs</span><span>All 63</span>
      </div>
      <div class="legend-row">
        <div class="legend-item">
          <div class="legend-swatch" style="background:linear-gradient(135deg,#10b981,#059669);border:1px solid rgba(52,211,153,0.5)"></div>
          Direct referral · you earn $<span id="legendDirect">33.75</span>
        </div>
        <div class="legend-item">
          <div class="legend-swatch" style="background:#3b82f6;opacity:0.8"></div>
          Upline overspill · you earn $<span id="legendOverspill">8.75</span>
        </div>
      </div>
    </div>

    <!-- Progress -->
    <div class="progress-wrap">
      <div class="progress-row">
        <span class="progress-label">Grid Progress</span>
        <span class="progress-value" id="progressVal">0 / 63 seats filled</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <!-- Advance note -->
    <div class="advance-note">
      <div style="font-size:19px;flex-shrink:0">♾️</div>
      <div>
        <div class="advance-note-title">Recurring Income Engine</div>
        <div class="advance-note-text">Once all 63 seats fill, your grid auto-advances with a fresh random pattern — directs and overspill redistributed — and the commissions start flowing again immediately.</div>
      </div>
    </div>

    <div class="advance-banner" id="advanceBanner">
      <div class="advance-title">⚡ GRID COMPLETE — NEW ADVANCE STARTING</div>
      <div class="advance-sub" id="advanceSubText"></div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="right-col">

    <!-- Tracker -->
    <div class="stat-card">
      <div class="eyebrow">Live Earnings Tracker</div>

      <div class="earn-row">
        <div class="earn-left">
          <div class="earn-dot" style="background:#10b981"></div>
          <div>
            <div class="earn-label">Direct Sponsor (25%)</div>
            <div class="earn-sub">$<span id="directPerSeat">25.00</span> · your personal referrals only</div>
          </div>
        </div>
        <div class="earn-amount" id="sponsorAmt" style="color:#10b981">$0.00</div>
      </div>

      <div class="earn-row">
        <div class="earn-left">
          <div class="earn-dot" style="background:#38bdf8"></div>
          <div>
            <div class="earn-label">Uni-Level (8.75%)</div>
            <div class="earn-sub">$<span id="uniPerSeat">8.75</span> · every seat, direct or overspill</div>
          </div>
        </div>
        <div class="earn-amount" id="uniAmt" style="color:#38bdf8">$0.00</div>
      </div>

    </div>

    <!-- Total -->
    <div class="total-card">
      <div class="total-label">Your Total This Advance</div>
      <div class="total-amount" id="totalAmt">$0.00</div>
      <div class="total-sub">Direct Sponsor + Uni-Level · <span id="directFilled">0</span> directs / <span id="overspillFilled">0</span> overspill so far</div>
    </div>

    <!-- Split bar -->
    <div class="split-card">
      <div class="eyebrow">Per Entry Distribution — $<span id="splitPrice">100</span></div>
      <div class="split-bar-wrap">
        <div class="split-seg" style="width:26.3%;background:#10b981"></div>
        <div class="split-seg" style="width:73.7%;background:linear-gradient(90deg,#3b82f6,#38bdf8)"></div>
      </div>
      <div class="split-legend">
        <div class="split-item">
          <div class="split-swatch" style="background:#10b981"></div>
          Direct Sponsor
          <span class="split-pct" id="sp1" style="color:#10b981">$25.00</span>
        </div>
        <div class="split-item">
          <div class="split-swatch" style="background:linear-gradient(135deg,#3b82f6,#38bdf8)"></div>
          Uni-Level (8 levels × $<span id="sp2lvl">8.75</span>)
          <span class="split-pct" id="sp2" style="color:#38bdf8">$70.00</span>
        </div>
      </div>
    </div>

    <!-- Package summary -->
    <div class="info-strip">
      <div class="info-title">Campaign Tier Summary</div>
      <div class="info-row">
        <span class="info-key">Tier price</span>
        <span class="info-val" id="infoPkg" style="color:var(--cyan)">$100 Pro</span>
      </div>
      <div class="info-row">
        <span class="info-key">Your directs this advance</span>
        <span class="info-val" id="infoDirectCount" style="color:#10b981">15 seats</span>
      </div>
      <div class="info-row">
        <span class="info-key">Overspill seats</span>
        <span class="info-val" id="infoOverspillCount" style="color:#38bdf8">48 seats</span>
      </div>
      <div class="info-row">
        <span class="info-key">Estimated full advance earnings</span>
        <span class="info-val" id="infoMax" style="color:var(--gold)">$926.25</span>
      </div>
    </div>

    <!-- Log -->
    <div class="log-card">
      <div class="eyebrow" style="font-size:10px;margin-bottom:10px">Activity Log</div>
      <div class="log-list" id="logList">
        <div class="log-item"><span style="color:rgba(255,255,255,0.2);font-size:11px">Waiting for grid to start...</span></div>
      </div>
    </div>

  </div>
</div>

<script>
// ── State ──────────────────────────────────────────────────────────────────
let pkg         = 100;
let cells       = [];
let filled      = 0;
let directFilled = 0;
let playing     = false;
let timer       = null;
let directCount = 15;       // how many of the 63 seats are your personal referrals
let directSeats = new Set(); // which seat indices (1–63) are directs — randomised each reset

// Running totals
let tSponsor = 0, tUni = 0;

const LEVEL_COLOURS = [
  '#38bdf8','#3b82f6','#6366f1','#0ea5e9',
  '#0ea5e9','#38bdf8','#b197fc','#c4b5fd'
];

// ── Randomise which seats are personal directs ─────────────────────────────
function randomiseDirects() {
  directSeats.clear();
  // Fisher-Yates shuffle of seats 1–63, pick first directCount
  const pool = Array.from({length:63}, (_,i) => i+1);
  for (let i = 62; i > 0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [pool[i], pool[j]] = [pool[j], pool[i]];
  }
  for (let i = 0; i < directCount; i++) directSeats.add(pool[i]);
}

// ── Tier / direct-count controls ───────────────────────────────────────
function selectPkg(btn) {
  document.querySelectorAll('.pkg-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  pkg = parseFloat(btn.dataset.price);
  updateSplitDisplay();
  resetGrid();
}

function updateDirectCount(val) {
  directCount = parseInt(val);
  document.getElementById('directCountDisplay').textContent = directCount;
  updateSplitDisplay();
  resetGrid();
}

function updateSplitDisplay() {
  const direct   = pkg * 0.25;
  const perLevel = pkg * 0.70 / 8;
  const uniTotal = pkg * 0.70;
  const overspill = 63 - directCount;
  // Your earnings: each direct = direct+perLevel, each overspill = perLevel
  const est = (directCount * (direct + perLevel)) + (overspill * perLevel);

  document.getElementById('splitPrice').textContent   = pkg.toLocaleString();
  document.getElementById('sp1').textContent          = '$' + direct.toFixed(2);
  document.getElementById('sp2lvl').textContent       = perLevel.toFixed(2);
  document.getElementById('sp2').textContent          = '$' + uniTotal.toFixed(2);
  document.getElementById('infoPkg').textContent      = '$' + pkg.toLocaleString();
  document.getElementById('infoDirectCount').textContent  = directCount + ' seats';
  document.getElementById('infoOverspillCount').textContent = overspill + ' seats';
  document.getElementById('infoMax').textContent      = '$' + est.toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2});
  document.getElementById('panelTitle').textContent   = `8×8 GRID — $${pkg.toLocaleString()} PACKAGE`;
  document.getElementById('directPerSeat').textContent = direct.toFixed(2);
  document.getElementById('uniPerSeat').textContent   = perLevel.toFixed(2);
  document.getElementById('legendDirect').textContent = (direct + perLevel).toFixed(2);
  document.getElementById('legendOverspill').textContent = perLevel.toFixed(2);
}

// ── Build grid ─────────────────────────────────────────────────────────────
function buildGrid() {
  const wrap   = document.getElementById('gridWrap');
  const labels = document.getElementById('levelLabels');
  wrap.innerHTML = ''; labels.innerHTML = ''; cells = [];

  for (let l = 0; l < 8; l++) {
    const lbl = document.createElement('div');
    lbl.className  = 'level-label';
    lbl.textContent = 'L' + (l+1);
    lbl.style.color = LEVEL_COLOURS[l] + '70';
    labels.appendChild(lbl);
  }

  for (let i = 0; i < 64; i++) {
    const c = document.createElement('div');
    c.className = 'cell';
    if (i === 0) {
      c.classList.add('owner');
      c.innerHTML = '<span style="font-size:clamp(12px,1.4vw,17px);font-weight:800;line-height:1.3;color:#fff">YOU</span>';
    }
    wrap.appendChild(c);
    cells.push(c);
  }
}

// ── Playback ───────────────────────────────────────────────────────────────
function togglePlay() { playing ? pause() : play(); }

function play() {
  playing = true;
  document.getElementById('playBtn').textContent = '⏸ PAUSE';
  tick();
}

function pause() {
  playing = false;
  clearTimeout(timer);
  document.getElementById('playBtn').textContent = '▶ PLAY';
}

function getDelay() {
  const v = parseInt(document.getElementById('speedSlider').value);
  return Math.round(700 - (v-1) * 150); // 700ms (slow) → 100ms (fast)
}

function tick() {
  if (!playing) return;
  if (filled >= 63) { gridAdvance(); return; }
  fillNext();
  timer = setTimeout(tick, getDelay());
}

// ── Fill one seat ──────────────────────────────────────────────────────────
function fillNext() {
  filled++;
  const cell     = cells[filled];
  const level    = Math.floor((filled - 1) / 8);  // 0 = L1 … 7 = L8
  const isDirect = directSeats.has(filled);
  const perLevel = pkg * 0.70 / 8;   // $8.75 on $100

  // ── COMMISSION LOGIC ──────────────────────────────────────────────────
  // Every seat pays you ONE uni-level position ($8.75 on $100).
  // If this seat is YOUR personal direct referral, you also receive
  // the 25% direct sponsor commission ($25 on $100).
  // ─────────────────────────────────────────────────────────────────────
  let youEarn = perLevel;
  if (isDirect) {
    tSponsor += pkg * 0.25;
    youEarn  += pkg * 0.25;
    directFilled++;
  }
  tUni      += perLevel;

  // Visual style
  const col = LEVEL_COLOURS[level];
  cell.classList.add('filled', isDirect ? 'direct' : 'overspill', 'pop');
  if (isDirect) {
    cell.style.background  = 'linear-gradient(135deg,#10b981,#059669)';
    cell.style.borderColor = 'rgba(52,211,153,0.7)';
    cell.style.boxShadow   = '0 0 18px rgba(16,185,129,0.55),0 0 36px rgba(16,185,129,0.18)';
    cell.style.color       = '#fff';
  } else {
    cell.style.background  = col;
    cell.style.borderColor = col + '40';
    cell.style.boxShadow   = `0 0 10px ${col}45`;
    cell.style.color       = 'rgba(255,255,255,0.9)';
  }
  cell.innerHTML = `+$${youEarn.toFixed(2)}`;
  setTimeout(() => cell.classList.remove('pop'), 450);

  // Update panels
  bump('sponsorAmt', tSponsor);
  bump('uniAmt',     tUni);
  document.getElementById('totalAmt').textContent = '$' + (tSponsor + tUni).toFixed(2);
  document.getElementById('directFilled').textContent   = directFilled;
  document.getElementById('overspillFilled').textContent = filled - directFilled;

  const pct = Math.round((filled / 63) * 100);
  document.getElementById('progressVal').textContent = `${filled} / 63 seats filled`;
  document.getElementById('progressFill').style.width = pct + '%';

  addLog(filled, level+1, isDirect, youEarn, isDirect ? '#10b981' : col);
}

// ── Helpers ────────────────────────────────────────────────────────────────
function bump(id, val) {
  const el = document.getElementById(id);
  el.textContent = '$' + val.toFixed(2);
  el.classList.remove('bump');
  void el.offsetWidth;
  el.classList.add('bump');
}

function addLog(seat, level, isDirect, amt, col) {
  const list = document.getElementById('logList');
  if (list.querySelector('[style*="0.2"]')) list.innerHTML = '';
  const tag   = isDirect
    ? '<span class="log-tag direct">DIRECT</span>'
    : '<span class="log-tag overspill">OVERSPILL</span>';
  const item  = document.createElement('div');
  item.className = 'log-item';
  item.innerHTML = `<div class="log-left"><span class="log-seat">#${String(seat).padStart(2,'0')}</span><span class="log-level">L${level}</span>${tag}</div><span class="log-amt" style="color:${col}">+$${amt.toFixed(2)}</span>`;
  list.insertBefore(item, list.firstChild);
  while (list.children.length > 10) list.removeChild(list.lastChild);
}

// ── Advance complete ─────────────────────────────────────────────────────────
function gridAdvance() {
  pause();
  const earned = (tSponsor + tUni).toFixed(2);
  document.getElementById('advanceSubText').textContent =
    `You earned $${earned} — ${directFilled} directs + ${63 - directFilled} overspill. New advance in 3 seconds with a fresh random mix...`;
  document.getElementById('advanceBanner').classList.add('show');
  setTimeout(() => {
    document.getElementById('advanceBanner').classList.remove('show');
    resetGrid();
    setTimeout(play, 500);
  }, 3500);
}

// ── Reset ──────────────────────────────────────────────────────────────────
function resetGrid() {
  pause();
  filled = 0; directFilled = 0;
  tSponsor = 0; tUni = 0;
  randomiseDirects();
  buildGrid();
  ['sponsorAmt','uniAmt'].forEach(id =>
    document.getElementById(id).textContent = '$0.00'
  );
  document.getElementById('totalAmt').textContent         = '$0.00';
  document.getElementById('progressVal').textContent      = '0 / 63 seats filled';
  document.getElementById('progressFill').style.width     = '0%';
  document.getElementById('directFilled').textContent     = '0';
  document.getElementById('overspillFilled').textContent  = '0';
  document.getElementById('logList').innerHTML            =
    '<div class="log-item"><span style="color:rgba(255,255,255,0.2);font-size:11px">Waiting for grid to start...</span></div>';
  document.getElementById('advanceBanner').classList.remove('show');
  document.getElementById('playBtn').textContent          = '▶ PLAY';
}

// ── Init ───────────────────────────────────────────────────────────────────
updateSplitDisplay();
randomiseDirects();
buildGrid();
</script>

<!-- ── Mobile Bottom Nav ── -->
<div class="mobile-nav">
  <div class="mobile-nav-inner">
    <a href="/dashboard" class="mob-nav-item"><span class="mob-nav-icon">⊞</span><span class="mob-nav-label">Home</span></a>
    <a href="/watch" class="mob-nav-item"><span class="mob-nav-icon">▶</span><span class="mob-nav-label">Watch</span></a>
    <a href="/income-grid" class="mob-nav-item active"><span class="mob-nav-icon">⚡</span><span class="mob-nav-label">Grid</span></a>
    <a href="/wallet" class="mob-nav-item"><span class="mob-nav-icon">◎</span><span class="mob-nav-label">Wallet</span></a>
    <a href="/account" class="mob-nav-item"><span class="mob-nav-icon">◉</span><span class="mob-nav-label">Account</span></a>
  </div>
</div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/static/sw.js').catch(() => {});
  });
}
</script>

</body>
</html>